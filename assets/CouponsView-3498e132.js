import{a as b}from"./axios-bff3f665.js";import{h as m}from"./moment-fbc5633a.js";import{C as M}from"./CPagination-bf0ce565.js";import{_ as f,M as y,o as d,a as i,e as o,l as u,q as r,u as k,g,t as p,r as h,b as _,F as v,f as D}from"./index-794ac18e.js";const O={props:{status:String,coupon:{type:Object,default(){return{}}},on_finish:Function},data(){return{newCoupon:{},modal:null}},watch:{coupon(e){this.newCoupon={...e,due_date:m.unix(e.due_date).format("YYYY-MM-DD")}}},methods:{show(){this.modal.show()},hide(){this.modal.hide()},async handleSubmit(){this.newCoupon.due_date=m(this.newCoupon.due_date).unix();try{let e="",t="";this.status==="new"?(e="post",t="https://vue3-course-api.hexschool.io/v2/api/catboxy/admin/coupon"):(e="put",t=`https://vue3-course-api.hexschool.io/v2/api/catboxy/admin/coupon/${this.newCoupon.id}`),await b({method:e,url:t,data:{data:this.newCoupon}}).catch(c=>{throw c.response.data.message}),this.modal.hide(),this.$emit("on_finish")}catch(e){alert(e)}}},async mounted(){this.modal=new y(this.$refs.modal)}},V={ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},Y={class:"modal-dialog"},S={class:"modal-content border-0"},L={class:"modal-header bg-dark text-white"},N={id:"couponModalLabel",class:"modal-title"},P={key:0},U={key:1},E=o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),F={class:"modal-body",style:{"text-align":"left"}},B={class:"row"},R={class:"col"},j={class:"mb-3"},J=o("label",{for:"title",class:"form-label"},"標題",-1),T={class:"mb-3"},q=o("label",{for:"code",class:"form-label"},"優惠碼",-1),z={class:"mb-3"},A=o("label",{for:"due_date",class:"form-label"},"到期日",-1),G={class:"mb-3"},H=o("label",{for:"percent",class:"form-label"},"折扣百分比",-1),I={class:"mb-3"},K={class:"form-check"},Q=o("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),W={class:"modal-footer"},X=o("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Z(e,t,c,C,s,a){return d(),i("div",V,[o("div",Y,[o("div",S,[o("div",L,[o("h5",N,[c.status==="new"?(d(),i("span",P,"新增產品")):(d(),i("span",U,"編輯產品"))]),E]),o("div",F,[o("div",B,[o("div",R,[o("div",j,[J,u(o("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":t[0]||(t[0]=n=>s.newCoupon.title=n)},null,512),[[r,s.newCoupon.title]])]),o("div",T,[q,u(o("input",{id:"code",type:"text",class:"form-control",placeholder:"請輸入優惠碼","onUpdate:modelValue":t[1]||(t[1]=n=>s.newCoupon.code=n)},null,512),[[r,s.newCoupon.code]])]),o("div",z,[A,u(o("input",{id:"due_date",type:"date",class:"form-control",placeholder:"請輸入到期日","onUpdate:modelValue":t[2]||(t[2]=n=>s.newCoupon.due_date=n)},null,512),[[r,s.newCoupon.due_date]])]),o("div",G,[H,u(o("input",{id:"percent",type:"number",class:"form-control",min:"0",max:"100",placeholder:"請輸入折扣百分比","onUpdate:modelValue":t[3]||(t[3]=n=>s.newCoupon.percent=n)},null,512),[[r,s.newCoupon.percent]])]),o("div",I,[o("div",K,[u(o("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[4]||(t[4]=n=>s.newCoupon.is_enabled=n)},null,512),[[k,s.newCoupon.is_enabled]]),Q])])])])]),o("div",W,[X,o("button",{type:"button",class:"btn btn-primary",onClick:t[5]||(t[5]=(...n)=>a.handleSubmit&&a.handleSubmit(...n))}," 確認 ")])])])],512)}const oo=f(O,[["render",Z]]),to={props:{coupon:Object,on_finish:Function},data(){return{}},methods:{show(){this.modal.show()},hide(){this.modal.hide()},async handleRemove(){try{await b({method:"delete",url:`https://vue3-course-api.hexschool.io/v2/api/catboxy/admin/coupon/${this.coupon.id}`}).catch(e=>{throw e.response.data.message}),this.modal.hide(),this.$emit("on_finish")}catch(e){alert(e)}}},async mounted(){this.modal=new y(this.$refs.modal)}},eo={ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},so={class:"modal-dialog"},no={class:"modal-content bcoupon-0"},ao=o("div",{class:"modal-header bg-danger text-white"},[o("h5",{id:"delProductModalLabel",class:"modal-title"},[o("span",null,"刪除優惠券")]),o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),lo={class:"modal-body"},io={class:"text-danger"},co={class:"modal-footer"},uo=o("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ro(e,t,c,C,s,a){return d(),i("div",eo,[o("div",so,[o("div",no,[ao,o("div",lo,[g(" 是否刪除 "),o("strong",io,p(c.coupon.title),1),g(" 優惠券(刪除後將無法恢復)。 ")]),o("div",co,[uo,o("button",{type:"button",class:"btn btn-danger",onClick:t[0]||(t[0]=(...n)=>a.handleRemove&&a.handleRemove(...n))}," 確認刪除 ")])])])],512)}const po=f(to,[["render",ro]]),ho={data(){return{status:"",coupons:[],pagination:{total_pages:1,current_page:1,has_pre:!1,has_next:!1,category:""},coupon:{}}},components:{CPagination:M,CModalCouponsDelete:po,CModalCouponsEdit:oo},methods:{addCoupon(){this.status="new",this.coupon={},this.$refs.adminCouponModal.show()},editCoupon(e){this.status="edit",this.coupon=JSON.parse(JSON.stringify(e)),this.$refs.adminCouponModal.show()},deleteCoupon(e){this.coupon=e,this.$refs.adminDeleteCouponModal.show()},async getCoupons(e){const t=await b({method:"get",url:"https://vue3-course-api.hexschool.io/v2/api/catboxy/admin/coupons",params:{page:e||this.pagination.current_page}});this.coupons=t.data.coupons,this.pagination=t.data.pagination},getDate(e){return m.unix(e).format("YYYY/MM/DD")}},async mounted(){await this.getCoupons()}},_o={class:"text-end mt-4"},mo={class:"text-center"},bo={class:"row"},fo={class:"col-12"},Co={class:"table align-middle"},go=o("thead",null,[o("tr",null,[o("th",null,"名稱"),o("th",null,"折扣百分比"),o("th",null,"到期日"),o("th",null,"是否啟用"),o("th",null,"編輯")])],-1),vo={key:0},yo={key:1},wo={class:"btn-group btn-group-sm"},xo=["onClick"],$o=["onClick"],Mo={class:"row"},ko={class:"col-12"};function Do(e,t,c,C,s,a){const n=h("CModalCouponsEdit"),w=h("CModalCouponsDelete"),x=h("CPagination");return d(),i(v,null,[_(n,{coupon:s.coupon,onOn_finish:a.getCoupons,status:s.status,ref:"adminCouponModal"},null,8,["coupon","onOn_finish","status"]),_(w,{coupon:s.coupon,onOn_finish:a.getCoupons,ref:"adminDeleteCouponModal"},null,8,["coupon","onOn_finish"]),o("div",_o,[o("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=(...l)=>a.addCoupon&&a.addCoupon(...l))}," 建立新的優惠券 ")]),o("div",mo,[o("div",bo,[o("div",fo,[o("table",Co,[go,o("tbody",null,[(d(!0),i(v,null,D(s.coupons,l=>(d(),i("tr",{key:l.id},[o("td",null,p(l.title),1),o("td",null,p(l.percent)+"%",1),o("td",null,p(a.getDate(l.due_date)),1),o("td",null,[l.is_enabled?(d(),i("span",vo,"啟用")):(d(),i("span",yo,"未啟用"))]),o("td",null,[o("div",wo,[o("button",{type:"button",class:"btn btn-outline-primary",onClick:$=>a.editCoupon(l)}," 編輯 ",8,xo),o("button",{type:"button",class:"btn btn-outline-danger",onClick:$=>a.deleteCoupon(l)}," 刪除 ",8,$o)])])]))),128))])])])]),o("div",Mo,[o("div",ko,[_(x,{total_pages:s.pagination.total_pages,onOn_page:a.getCoupons},null,8,["total_pages","onOn_page"])])])])],64)}const Lo=f(ho,[["render",Do]]);export{Lo as default};
