import{C as $,a as k}from"./CFooter-76c068d2.js";import{_ as q,T as d,r as b,o as f,a as v,b as e,d as t,F as x,e as S,w as y,t as h,j as F,k as N,n as c}from"./index-96ac87d6.js";import{a as m}from"./axios-bff3f665.js";const P={components:{CNavbar:$,CFooter:k},data(){return{step:"",carts:null,total:0,final_total:0,orderId:""}},methods:{async getCart(){const a=await m({method:"get",url:"https://vue3-course-api.hexschool.io/v2/api/catboxy/cart"});this.carts=a.data.data.carts,this.final_total=a.data.data.final_total,this.total=a.data.data.total},async addCart(a,o=1){await m({method:"post",url:"https://vue3-course-api.hexschool.io/v2/api/catboxy/cart",data:{data:{product_id:a,qty:o}}})},async updateCart(a,o,u){await m({method:"put",url:`https://vue3-course-api.hexschool.io/v2/api/catboxy/cart/${a}`,data:{data:{product_id:o,qty:u}}}),await this.getCart()},async deleteCart(a,o){await m({method:"delete",url:`https://vue3-course-api.hexschool.io/v2/api/catboxy/cart/${a}`,data:{data:{id:o}}}),await this.getCart()},checkMobilePhone(a){return/^09[0-9]{8}$/.test(a)?!0:"需要正確的電話號碼"},async handleCouponSubmit(a){await m({method:"post",url:"https://vue3-course-api.hexschool.io/v2/api/catboxy/coupon",data:{data:{code:a.code}}}).catch(o=>{alert(o.response.data.message)}),this.$refs.couponForm.resetForm(),await this.getCart()},async handleConfirmSubmit(){new d(this.$refs["profile-tab"]).show(),this.$router.push({path:"/cart",query:{step:"profile"}}),document.documentElement.scrollTop=0},async handleProfileSubmit(a){const o=await m({method:"post",url:"https://vue3-course-api.hexschool.io/v2/api/catboxy/order",data:{data:{user:{email:a.email,name:a.name,tel:a.mobilePhone,address:a.address},message:a.message}}}).catch(g=>{alert(g.response.data.message)});this.orderId=o.data.orderId,this.$refs.profileForm.resetForm(),await this.getCart(),new d(this.$refs["pay-tab"]).show(),this.$router.push({path:"/cart",query:{step:"pay",orderId:this.orderId}}),document.documentElement.scrollTop=0},async handlePaySubmit(){await m({method:"post",url:`https://vue3-course-api.hexschool.io/v2/api/catboxy/pay/${this.orderId}`}).catch(o=>{alert(o.response.data.message)}),this.$refs.payForm.resetForm(),new d(this.$refs["success-tab"]).show(),this.$router.push({path:"/cart",query:{step:"success"}}),document.documentElement.scrollTop=0}},async mounted(){this.getCart(),this.step=this.$route.query.step,this.step==="profile"?new d(this.$refs["profile-tab"]).show():this.step==="pay"?(new d(this.$refs["pay-tab"]).show(),this.orderId=this.$route.query.orderId):this.step==="success"?new d(this.$refs["success-tab"]).show():new d(this.$refs["confirm-tab"]).show()}},I={class:"container"},E={class:"row"},B={class:"col"},V={class:"nav nav-tabs",id:"myTab",role:"tablist"},j={class:"nav-item",role:"presentation"},M={class:"nav-link active",id:"confirm-tab",ref:"confirm-tab","data-bs-toggle":"tab","data-bs-target":"#confirm-tab-pane",type:"button",role:"tab","aria-controls":"confirm-tab-pane","aria-selected":"true"},U={class:"nav-item",role:"presentation"},D={class:"nav-link",id:"profile-tab",ref:"profile-tab","data-bs-toggle":"tab","data-bs-target":"#profile-tab-pane",type:"button",role:"tab","aria-controls":"profile-tab-pane","aria-selected":"false"},z={class:"nav-item",role:"presentation"},L={class:"nav-link",id:"pay-tab",ref:"pay-tab","data-bs-toggle":"tab","data-bs-target":"#pay-tab-pane",type:"button",role:"tab","aria-controls":"pay-tab-pane","aria-selected":"false"},A={class:"nav-item",role:"presentation"},G={class:"nav-link",id:"success-tab",ref:"success-tab","data-bs-toggle":"tab","data-bs-target":"#success-tab-pane",type:"button",role:"tab","aria-controls":"success-tab-pane","aria-selected":"false"},H={class:"tab-content",id:"myTabContent"},J={class:"tab-pane fade show active",id:"confirm-tab-pane",role:"tabpanel","aria-labelledby":"confirm-tab",tabindex:"0"},K=t("div",{class:"my-3"},[t("h5",null,"確認訂單資訊")],-1),O={class:"row"},Q={class:"col-12"},R={class:"table"},W=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"資料序"),t("th",{scope:"col"},"商品圖片"),t("th",{scope:"col"},"商品名稱"),t("th",{scope:"col"},"原價"),t("th",{scope:"col"},"單價"),t("th",{scope:"col"},"數量 / 單位"),t("th",{scope:"col"},"金額小計"),t("th",{scope:"col"},"取消")])],-1),X={scope:"row"},Y=["src"],Z={style:{width:"150px"}},tt={class:"input-group input-group-sm"},st={class:"input-group mb-3"},et=["onBlur","onUpdate:modelValue"],at={class:"input-group-text",id:"basic-addon2"},ot=["onClick"],lt={class:"row"},it={class:"row"},ct=t("label",{for:"staticTotal",class:"col-sm-3 col-form-label"},"訂單金額小計：",-1),nt={class:"col-sm-9"},rt={class:"mb-3"},dt=["value"],mt={class:"row"},ht=t("label",{for:"code",class:"col-sm-3 col-form-label"},"使用優惠碼：",-1),bt={class:"col-sm-3 mb-3"},ut=t("div",{class:"col-sm-6 mb-3"},[t("button",{type:"submit",class:"btn btn-primary"}," 套用優惠碼 ")],-1),pt={class:"row"},_t=t("label",{for:"staticTotal",class:"col-sm-3 col-form-label"},"您的優惠折扣：",-1),ft={class:"col-sm-9"},vt={class:"mb-3"},yt=["value"],gt={class:"row"},xt=t("label",{for:"staticTotal",class:"col-sm-3 col-form-label"},"折扣後訂單總金額：",-1),wt={class:"col-sm-9"},Ct={class:"mb-3"},Tt=["value"],$t={class:"text-end"},kt={class:"tab-pane fade",id:"profile-tab-pane",role:"tabpanel","aria-labelledby":"profile-tab",tabindex:"0"},qt=t("div",{class:"my-3"},[t("h5",null,"填寫收件資訊")],-1),St={class:"row"},Ft={class:"col-12 justify-content-center"},Nt={class:"mb-3"},Pt=t("label",{for:"name",class:"form-label"},"收件人姓名",-1),It={class:"mb-3"},Et=t("label",{for:"mobilePhone",class:"form-label"},"收件人手機號碼",-1),Bt={class:"mb-3"},Vt=t("label",{for:"email",class:"form-label"},"Email",-1),jt={class:"mb-3"},Mt=t("label",{for:"address",class:"form-label"},"收件人地址",-1),Ut={class:"mb-3"},Dt=t("label",{for:"message",class:"form-label"},"留言",-1),zt=t("div",{class:"text-end"},[t("button",{type:"submit",class:"btn btn-primary"}," 送出訂單 ")],-1),Lt={class:"tab-pane fade",id:"pay-tab-pane",role:"tabpanel","aria-labelledby":"pay-tab",tabindex:"0"},At=t("div",{class:"my-3"},[t("h5",null,"填寫信用卡資訊")],-1),Gt={class:"row"},Ht={class:"col-12 justify-content-center"},Jt={class:"mb-3"},Kt=t("label",{for:"creditCard",class:"form-label"},"信用卡號",-1),Ot=t("div",{class:"row"},[t("div",{class:"col-md-12"},[t("label",{for:"firstName",class:"form-label"},"持卡人姓名")])],-1),Qt={class:"row"},Rt={class:"mb-3 col-md-6"},Wt={class:"mb-3 col-md-6"},Xt=t("div",{class:"row"},[t("div",{class:"col-md-12"},[t("label",{for:"month",class:"form-label"},"有效期限")])],-1),Yt={class:"row"},Zt={class:"mb-3 col-md-6"},ts={class:"mb-3 col-md-6"},ss={class:"mb-3"},es=t("label",{for:"security",class:"form-label"},"安全碼",-1),as=t("div",{class:"text-end"},[t("button",{type:"submit",class:"btn btn-primary"}," 付款 ")],-1),os=t("div",{class:"tab-pane fade",id:"success-tab-pane",role:"tabpanel","aria-labelledby":"success-tab",tabindex:"0"},[t("div",{class:"my-3"},[t("h5",null,"完成訂購")]),t("div",null,"交易已完成，您可於三至五分鐘後至電子信箱收取訂單資訊郵件。"),t("div",null,"謝謝您的購買與支持，小幫手正快馬加鞭包裝與出貨中。"),t("div",null,"關於訂單若有任何需求，請洽0800-000-000，將由專人為您服務。")],-1);function ls(a,o,u,g,r,n){const w=b("CNavbar"),l=b("v-field"),p=b("v-form"),i=b("error-message"),C=b("CFooter");return f(),v(x,null,[e(w),t("div",I,[t("div",E,[t("div",B,[t("ul",V,[t("li",j,[t("button",M,"確認訂單",512)]),t("li",U,[t("button",D,"收件資訊",512)]),t("li",z,[t("button",L,"付款資訊",512)]),t("li",A,[t("button",G,"完成訂購",512)])]),t("div",H,[t("div",J,[K,t("div",O,[t("div",Q,[t("table",R,[W,t("tbody",null,[(f(!0),v(x,null,S(r.carts,(s,T)=>(f(),v("tr",{key:s.id},[t("th",X,h(T+1),1),t("td",null,[t("img",{src:s.product.imageUrl,style:{"object-fit":"cover",height:"150px","max-width":"150px"},alt:"",srcset:""},null,8,Y)]),t("td",null,h(s.product.title),1),t("td",null,h(s.product.origin_price),1),t("td",null,h(s.product.price),1),t("td",Z,[t("div",tt,[t("div",st,[F(t("input",{min:"1",type:"number",class:"form-control",onBlur:_=>n.updateCart(s.id,s.product.id,s.qty),"onUpdate:modelValue":_=>s.qty=_},null,40,et),[[N,s.qty]]),t("span",at,h(s.product.unit),1)])])]),t("td",null,h(s.total)+" 元",1),t("td",null,[t("button",{type:"button",class:"btn btn-danger",onClick:_=>n.deleteCart(s.id,s.product.id)},"刪除",8,ot)])]))),128))])])])]),t("div",lt,[e(p,{onSubmit:n.handleCouponSubmit,ref:"couponForm",class:"col"},{default:y(()=>[t("div",it,[ct,t("div",nt,[t("div",rt,[t("input",{type:"text",readonly:"",class:"form-control-plaintext",id:"staticTotal",value:`${r.total} 元`},null,8,dt)])])]),t("div",mt,[ht,t("div",bt,[e(l,{id:"code",name:"code",type:"text",class:"form-control",placeholder:"請輸入優惠碼"})]),ut]),t("div",pt,[_t,t("div",ft,[t("div",vt,[t("input",{type:"text",readonly:"",class:"form-control-plaintext",id:"staticTotal",value:r.final_total!==r.total?`${parseInt(100*r.final_total/r.total,10)} ％`:"無"},null,8,yt)])])]),t("div",gt,[xt,t("div",wt,[t("div",Ct,[t("input",{type:"text",readonly:"",class:"form-control-plaintext",id:"staticTotal",value:`${r.final_total} 元`},null,8,Tt)])])]),t("div",$t,[t("button",{type:"button",class:"btn btn-primary",onClick:o[0]||(o[0]=(...s)=>n.handleConfirmSubmit&&n.handleConfirmSubmit(...s))},"下一步")])]),_:1},8,["onSubmit"])])]),t("div",kt,[qt,t("div",St,[t("div",Ft,[e(p,{onSubmit:n.handleProfileSubmit,ref:"profileForm",class:"col"},{default:y(({errors:s})=>[t("div",Nt,[Pt,e(l,{id:"name",name:"name",type:"text",class:c(["form-control",{"is-invalid":s.name}]),placeholder:"請輸入姓名",rules:"required"},null,8,["class"]),e(i,{name:"name",class:"invalid-feedback"})]),t("div",It,[Et,e(l,{id:"mobilePhone",name:"mobilePhone",type:"text",class:c(["form-control",{"is-invalid":s.mobilePhone}]),placeholder:"請輸入手機號碼",rules:n.checkMobilePhone},null,8,["class","rules"]),e(i,{name:"mobilePhone",class:"invalid-feedback"})]),t("div",Bt,[Vt,e(l,{id:"email",name:"email",type:"email",class:c(["form-control",{"is-invalid":s.email}]),placeholder:"請輸入 Email",rules:"email|required"},null,8,["class"]),e(i,{name:"email",class:"invalid-feedback"})]),t("div",jt,[Mt,e(l,{id:"address",name:"address",type:"text",class:c(["form-control",{"is-invalid":s.address}]),placeholder:"請輸入地址",rules:"required"},null,8,["class"]),e(i,{name:"address",class:"invalid-feedback"})]),t("div",Ut,[Dt,e(l,{id:"message",name:"message",class:"form-control",cols:"30",rows:"10",rules:"required",as:"textarea"})]),zt]),_:1},8,["onSubmit"])])])]),t("div",Lt,[At,t("div",Gt,[t("div",Ht,[e(p,{onSubmit:n.handlePaySubmit,ref:"payForm",class:"col"},{default:y(({errors:s})=>[t("div",Jt,[Kt,e(l,{id:"creditCard",name:"creditCard",type:"text",class:c(["form-control",{"is-invalid":s.creditCard}]),placeholder:"請輸入信用卡號",rules:{required:!0,regex:/^\d{4}-\d{4}-\d{4}-\d{4}$/}},null,8,["class"]),e(i,{name:"creditCard",class:"invalid-feedback"})]),Ot,t("div",Qt,[t("div",Rt,[e(l,{id:"firstName",name:"firstName",type:"text",class:c(["form-control",{"is-invalid":s.firstName}]),placeholder:"請輸入姓氏",rules:"required"},null,8,["class"]),e(i,{name:"firstName",class:"invalid-feedback"})]),t("div",Wt,[e(l,{id:"lastName",name:"lastName",type:"text",class:c(["form-control",{"is-invalid":s.lastName}]),placeholder:"請輸入名字",rules:"required"},null,8,["class"]),e(i,{name:"lastName",class:"invalid-feedback"})])]),Xt,t("div",Yt,[t("div",Zt,[e(l,{id:"month",name:"month",type:"text",class:c(["form-control",{"is-invalid":s.month}]),placeholder:"請輸入月份",rules:"required"},null,8,["class"]),e(i,{name:"month",class:"invalid-feedback"})]),t("div",ts,[e(l,{id:"year",name:"year",type:"text",class:c(["form-control",{"is-invalid":s.year}]),placeholder:"請輸入年份",rules:"required"},null,8,["class"]),e(i,{name:"year",class:"invalid-feedback"})])]),t("div",ss,[es,e(l,{id:"security",name:"security",type:"text",class:c(["form-control",{"is-invalid":s.security}]),placeholder:"請輸入安全碼",rules:"required"},null,8,["class"]),e(i,{name:"security",class:"invalid-feedback"})]),as]),_:1},8,["onSubmit"])])])]),os])])])]),e(C)],64)}const rs=q(P,[["render",ls]]);export{rs as default};
