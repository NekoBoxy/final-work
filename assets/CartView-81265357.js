import{C as $,a as k}from"./CFooter-12cf17cd.js";import{_ as q,m as S,T as d,r as b,o as f,a as v,b as e,e as t,F as x,f as N,w as y,t as m,l as F,q as P,n as c}from"./index-3186d88b.js";import{a as h}from"./axios-bff3f665.js";import{u as I}from"./cart-1869fbff.js";const E={components:{CNavbar:$,CFooter:k},data(){return{step:"",carts:null,total:0,final_total:0,orderId:""}},methods:{...S(I,["updateNum"]),async getCart(){const a=await h({method:"get",url:"https://vue3-course-api.hexschool.io/v2/api/catboxy/cart"});this.carts=a.data.data.carts,this.final_total=a.data.data.final_total,this.total=a.data.data.total},async updateCart(a,o,u){await h({method:"put",url:`https://vue3-course-api.hexschool.io/v2/api/catboxy/cart/${a}`,data:{data:{product_id:o,qty:u}}}),await this.getCart()},async deleteCart(a,o){await h({method:"delete",url:`https://vue3-course-api.hexschool.io/v2/api/catboxy/cart/${a}`,data:{data:{id:o}}}),await this.getCart(),await this.updateNum()},checkMobilePhone(a){return/^09[0-9]{8}$/.test(a)?!0:"需要正確的電話號碼"},async handleCouponSubmit(a){await h({method:"post",url:"https://vue3-course-api.hexschool.io/v2/api/catboxy/coupon",data:{data:{code:a.code}}}).catch(o=>{alert(o.response.data.message)}),this.$refs.couponForm.resetForm(),await this.getCart()},async handleConfirmSubmit(){new d(this.$refs["profile-tab"]).show(),this.$router.push({path:"/cart",query:{step:"profile"}}),document.documentElement.scrollTop=0},async handleProfileSubmit(a){const o=await h({method:"post",url:"https://vue3-course-api.hexschool.io/v2/api/catboxy/order",data:{data:{user:{email:a.email,name:a.name,tel:a.mobilePhone,address:a.address},message:a.message}}}).catch(g=>{alert(g.response.data.message)});this.orderId=o.data.orderId,this.$refs.profileForm.resetForm(),await this.getCart(),new d(this.$refs["pay-tab"]).show(),this.$router.push({path:"/cart",query:{step:"pay",orderId:this.orderId}}),document.documentElement.scrollTop=0},async handlePaySubmit(){await h({method:"post",url:`https://vue3-course-api.hexschool.io/v2/api/catboxy/pay/${this.orderId}`}).catch(o=>{alert(o.response.data.message)}),this.$refs.payForm.resetForm(),new d(this.$refs["success-tab"]).show(),this.$router.push({path:"/cart",query:{step:"success"}}),document.documentElement.scrollTop=0}},async mounted(){this.getCart(),this.step=this.$route.query.step,this.step==="profile"?new d(this.$refs["profile-tab"]).show():this.step==="pay"?(new d(this.$refs["pay-tab"]).show(),this.orderId=this.$route.query.orderId):this.step==="success"?new d(this.$refs["success-tab"]).show():new d(this.$refs["confirm-tab"]).show()}},B={class:"container"},V={class:"row"},j={class:"col"},M={class:"nav nav-tabs",id:"myTab",role:"tablist"},U={class:"nav-item",role:"presentation"},D={class:"nav-link active",id:"confirm-tab",ref:"confirm-tab","data-bs-toggle":"tab","data-bs-target":"#confirm-tab-pane",type:"button",role:"tab","aria-controls":"confirm-tab-pane","aria-selected":"true"},z={class:"nav-item",role:"presentation"},A={class:"nav-link",id:"profile-tab",ref:"profile-tab","data-bs-toggle":"tab","data-bs-target":"#profile-tab-pane",type:"button",role:"tab","aria-controls":"profile-tab-pane","aria-selected":"false"},L={class:"nav-item",role:"presentation"},G={class:"nav-link",id:"pay-tab",ref:"pay-tab","data-bs-toggle":"tab","data-bs-target":"#pay-tab-pane",type:"button",role:"tab","aria-controls":"pay-tab-pane","aria-selected":"false"},H={class:"nav-item",role:"presentation"},J={class:"nav-link",id:"success-tab",ref:"success-tab","data-bs-toggle":"tab","data-bs-target":"#success-tab-pane",type:"button",role:"tab","aria-controls":"success-tab-pane","aria-selected":"false"},K={class:"tab-content",id:"myTabContent"},O={class:"tab-pane fade show active",id:"confirm-tab-pane",role:"tabpanel","aria-labelledby":"confirm-tab",tabindex:"0"},Q=t("div",{class:"my-3"},[t("h5",null,"確認訂單資訊")],-1),R={class:"row"},W={class:"col-12"},X={class:"table"},Y=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"資料序"),t("th",{scope:"col"},"商品圖片"),t("th",{scope:"col"},"商品名稱"),t("th",{scope:"col"},"原價"),t("th",{scope:"col"},"單價"),t("th",{scope:"col"},"數量 / 單位"),t("th",{scope:"col"},"金額小計"),t("th",{scope:"col"},"取消")])],-1),Z={scope:"row"},tt=["src"],st={style:{width:"150px"}},et={class:"input-group input-group-sm"},at={class:"input-group mb-3"},ot=["onBlur","onUpdate:modelValue"],lt={class:"input-group-text",id:"basic-addon2"},it=["onClick"],ct={class:"row"},nt={class:"row"},rt=t("label",{for:"staticTotal",class:"col-sm-3 col-form-label"},"訂單金額小計：",-1),dt={class:"col-sm-9"},mt={class:"mb-3"},ht=["value"],bt={class:"row"},ut=t("label",{for:"code",class:"col-sm-3 col-form-label"},"使用優惠碼：",-1),pt={class:"col-sm-3 mb-3"},_t=t("div",{class:"col-sm-6 mb-3"},[t("button",{type:"submit",class:"btn btn-primary"}," 套用優惠碼 ")],-1),ft={class:"row"},vt=t("label",{for:"staticTotal",class:"col-sm-3 col-form-label"},"您的優惠折扣：",-1),yt={class:"col-sm-9"},gt={class:"mb-3"},xt=["value"],wt={class:"row"},Ct=t("label",{for:"staticTotal",class:"col-sm-3 col-form-label"},"折扣後訂單總金額：",-1),Tt={class:"col-sm-9"},$t={class:"mb-3"},kt=["value"],qt={class:"text-end"},St={class:"tab-pane fade",id:"profile-tab-pane",role:"tabpanel","aria-labelledby":"profile-tab",tabindex:"0"},Nt=t("div",{class:"my-3"},[t("h5",null,"填寫收件資訊")],-1),Ft={class:"row"},Pt={class:"col-12 justify-content-center"},It={class:"mb-3"},Et=t("label",{for:"name",class:"form-label"},"收件人姓名",-1),Bt={class:"mb-3"},Vt=t("label",{for:"mobilePhone",class:"form-label"},"收件人手機號碼",-1),jt={class:"mb-3"},Mt=t("label",{for:"email",class:"form-label"},"Email",-1),Ut={class:"mb-3"},Dt=t("label",{for:"address",class:"form-label"},"收件人地址",-1),zt={class:"mb-3"},At=t("label",{for:"message",class:"form-label"},"留言",-1),Lt=t("div",{class:"text-end"},[t("button",{type:"submit",class:"btn btn-primary"}," 送出訂單 ")],-1),Gt={class:"tab-pane fade",id:"pay-tab-pane",role:"tabpanel","aria-labelledby":"pay-tab",tabindex:"0"},Ht=t("div",{class:"my-3"},[t("h5",null,"填寫信用卡資訊")],-1),Jt={class:"row"},Kt={class:"col-12 justify-content-center"},Ot={class:"mb-3"},Qt=t("label",{for:"creditCard",class:"form-label"},"信用卡號",-1),Rt=t("div",{class:"row"},[t("div",{class:"col-md-12"},[t("label",{for:"firstName",class:"form-label"},"持卡人姓名")])],-1),Wt={class:"row"},Xt={class:"mb-3 col-md-6"},Yt={class:"mb-3 col-md-6"},Zt=t("div",{class:"row"},[t("div",{class:"col-md-12"},[t("label",{for:"month",class:"form-label"},"有效期限")])],-1),ts={class:"row"},ss={class:"mb-3 col-md-6"},es={class:"mb-3 col-md-6"},as={class:"mb-3"},os=t("label",{for:"security",class:"form-label"},"安全碼",-1),ls=t("div",{class:"text-end"},[t("button",{type:"submit",class:"btn btn-primary"}," 付款 ")],-1),is=t("div",{class:"tab-pane fade",id:"success-tab-pane",role:"tabpanel","aria-labelledby":"success-tab",tabindex:"0"},[t("div",{class:"my-3"},[t("h5",null,"完成訂購")]),t("div",null,"交易已完成，您可於三至五分鐘後至電子信箱收取訂單資訊郵件。"),t("div",null,"謝謝您的購買與支持，小幫手正快馬加鞭包裝與出貨中。"),t("div",null,"關於訂單若有任何需求，請洽0800-000-000，將由專人為您服務。")],-1);function cs(a,o,u,g,r,n){const w=b("CNavbar"),l=b("v-field"),p=b("v-form"),i=b("error-message"),C=b("CFooter");return f(),v(x,null,[e(w),t("div",B,[t("div",V,[t("div",j,[t("ul",M,[t("li",U,[t("button",D,"確認訂單",512)]),t("li",z,[t("button",A,"收件資訊",512)]),t("li",L,[t("button",G,"付款資訊",512)]),t("li",H,[t("button",J,"完成訂購",512)])]),t("div",K,[t("div",O,[Q,t("div",R,[t("div",W,[t("table",X,[Y,t("tbody",null,[(f(!0),v(x,null,N(r.carts,(s,T)=>(f(),v("tr",{key:s.id},[t("th",Z,m(T+1),1),t("td",null,[t("img",{src:s.product.imageUrl,style:{"object-fit":"cover",height:"150px","max-width":"150px"},alt:"",srcset:""},null,8,tt)]),t("td",null,m(s.product.title),1),t("td",null,m(s.product.origin_price),1),t("td",null,m(s.product.price),1),t("td",st,[t("div",et,[t("div",at,[F(t("input",{min:"1",type:"number",class:"form-control",onBlur:_=>n.updateCart(s.id,s.product.id,s.qty),"onUpdate:modelValue":_=>s.qty=_},null,40,ot),[[P,s.qty]]),t("span",lt,m(s.product.unit),1)])])]),t("td",null,m(s.total)+" 元",1),t("td",null,[t("button",{type:"button",class:"btn btn-danger",onClick:_=>n.deleteCart(s.id,s.product.id)},"刪除",8,it)])]))),128))])])])]),t("div",ct,[e(p,{onSubmit:n.handleCouponSubmit,ref:"couponForm",class:"col"},{default:y(()=>[t("div",nt,[rt,t("div",dt,[t("div",mt,[t("input",{type:"text",readonly:"",class:"form-control-plaintext",id:"staticTotal",value:`${r.total} 元`},null,8,ht)])])]),t("div",bt,[ut,t("div",pt,[e(l,{id:"code",name:"code",type:"text",class:"form-control",placeholder:"請輸入優惠碼"})]),_t]),t("div",ft,[vt,t("div",yt,[t("div",gt,[t("input",{type:"text",readonly:"",class:"form-control-plaintext",id:"staticTotal",value:r.final_total!==r.total?`${parseInt(100*r.final_total/r.total,10)} ％`:"無"},null,8,xt)])])]),t("div",wt,[Ct,t("div",Tt,[t("div",$t,[t("input",{type:"text",readonly:"",class:"form-control-plaintext",id:"staticTotal",value:`${r.final_total} 元`},null,8,kt)])])]),t("div",qt,[t("button",{type:"button",class:"btn btn-primary",onClick:o[0]||(o[0]=(...s)=>n.handleConfirmSubmit&&n.handleConfirmSubmit(...s))},"下一步")])]),_:1},8,["onSubmit"])])]),t("div",St,[Nt,t("div",Ft,[t("div",Pt,[e(p,{onSubmit:n.handleProfileSubmit,ref:"profileForm",class:"col"},{default:y(({errors:s})=>[t("div",It,[Et,e(l,{id:"name",name:"name",type:"text",class:c(["form-control",{"is-invalid":s.name}]),placeholder:"請輸入姓名",rules:"required"},null,8,["class"]),e(i,{name:"name",class:"invalid-feedback"})]),t("div",Bt,[Vt,e(l,{id:"mobilePhone",name:"mobilePhone",type:"text",class:c(["form-control",{"is-invalid":s.mobilePhone}]),placeholder:"請輸入手機號碼",rules:n.checkMobilePhone},null,8,["class","rules"]),e(i,{name:"mobilePhone",class:"invalid-feedback"})]),t("div",jt,[Mt,e(l,{id:"email",name:"email",type:"email",class:c(["form-control",{"is-invalid":s.email}]),placeholder:"請輸入 Email",rules:"email|required"},null,8,["class"]),e(i,{name:"email",class:"invalid-feedback"})]),t("div",Ut,[Dt,e(l,{id:"address",name:"address",type:"text",class:c(["form-control",{"is-invalid":s.address}]),placeholder:"請輸入地址",rules:"required"},null,8,["class"]),e(i,{name:"address",class:"invalid-feedback"})]),t("div",zt,[At,e(l,{id:"message",name:"message",class:"form-control",cols:"30",rows:"10",rules:"required",as:"textarea"})]),Lt]),_:1},8,["onSubmit"])])])]),t("div",Gt,[Ht,t("div",Jt,[t("div",Kt,[e(p,{onSubmit:n.handlePaySubmit,ref:"payForm",class:"col"},{default:y(({errors:s})=>[t("div",Ot,[Qt,e(l,{id:"creditCard",name:"creditCard",type:"text",class:c(["form-control",{"is-invalid":s.creditCard}]),placeholder:"請輸入信用卡號",rules:{required:!0,regex:/^\d{4}-\d{4}-\d{4}-\d{4}$/}},null,8,["class"]),e(i,{name:"creditCard",class:"invalid-feedback"})]),Rt,t("div",Wt,[t("div",Xt,[e(l,{id:"firstName",name:"firstName",type:"text",class:c(["form-control",{"is-invalid":s.firstName}]),placeholder:"請輸入姓氏",rules:"required"},null,8,["class"]),e(i,{name:"firstName",class:"invalid-feedback"})]),t("div",Yt,[e(l,{id:"lastName",name:"lastName",type:"text",class:c(["form-control",{"is-invalid":s.lastName}]),placeholder:"請輸入名字",rules:"required"},null,8,["class"]),e(i,{name:"lastName",class:"invalid-feedback"})])]),Zt,t("div",ts,[t("div",ss,[e(l,{id:"month",name:"month",type:"text",class:c(["form-control",{"is-invalid":s.month}]),placeholder:"請輸入月份",rules:"required"},null,8,["class"]),e(i,{name:"month",class:"invalid-feedback"})]),t("div",es,[e(l,{id:"year",name:"year",type:"text",class:c(["form-control",{"is-invalid":s.year}]),placeholder:"請輸入年份",rules:"required"},null,8,["class"]),e(i,{name:"year",class:"invalid-feedback"})])]),t("div",as,[os,e(l,{id:"security",name:"security",type:"text",class:c(["form-control",{"is-invalid":s.security}]),placeholder:"請輸入安全碼",rules:"required"},null,8,["class"]),e(i,{name:"security",class:"invalid-feedback"})]),ls]),_:1},8,["onSubmit"])])])]),is])])])]),e(C)],64)}const hs=q(E,[["render",cs]]);export{hs as default};
