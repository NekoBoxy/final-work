import{a as f}from"./axios-bff3f665.js";import{h}from"./moment-fbc5633a.js";import{C as $}from"./CPagination-79544886.js";import{_ as C,M as v,o as d,a as i,b as t,q as r,x as _,y as D,i as y,t as p,m as k,r as m,e as b,F as g,f as Y,u as F}from"./index-d155b768.js";const L={props:{status:String,coupon:{type:Object,default(){return{}}},on_finish:Function},data(){return{newCoupon:{},modal:null}},watch:{coupon(o){this.newCoupon={...o,is_enabled:o.is_enabled===void 0?1:o.is_enabled,due_date:o.due_date===void 0?h().format("YYYY-MM-DD"):h.unix(o.due_date).format("YYYY-MM-DD")}}},methods:{minDate(){return h(new Date,"YYYY-MM-DD").add(1,"days").format("YYYY-MM-DD")},show(){this.modal.show()},hide(){this.modal.hide()},async handleSubmit(){try{const o=parseInt(this.newCoupon.percent,10);if(o<0||o>100){alert("百分比格式錯誤");return}const e=new Date,c=new Date(this.newCoupon.due_date);if(e.getTime()-c.getTime()>0){alert("日期格式錯誤");return}let u="",s="";this.status==="new"?(u="post",s="https://vue3-course-api.hexschool.io/v2/api/catboxy/admin/coupon"):(u="put",s=`https://vue3-course-api.hexschool.io/v2/api/catboxy/admin/coupon/${this.newCoupon.id}`),await f({method:u,url:s,data:{data:{...this.newCoupon,due_date:h(this.newCoupon.due_date).unix()}}}).catch(n=>{throw n.response.data.message}),this.modal.hide(),this.$emit("on_finish")}catch(o){alert(o)}}},async mounted(){this.modal=new v(this.$refs.modal)}},O={ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},S={class:"modal-dialog"},z={class:"modal-content border-0"},N={class:"modal-header bg-dark text-white"},P={id:"couponModalLabel",class:"modal-title"},U={key:0},V={key:1},E=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),T={class:"modal-body",style:{"text-align":"left"}},B={class:"row"},R={class:"col"},j={class:"mb-3"},J=t("label",{for:"title",class:"form-label"},"標題",-1),q=t("span",{class:"fw-light",style:{color:"#FF0000","font-size":"0.8rem"}},"*必填",-1),A={class:"mb-3"},I=t("label",{for:"code",class:"form-label"},"優惠碼",-1),G=t("span",{class:"fw-light",style:{color:"#FF0000","font-size":"0.8rem"}},"*必填",-1),H={class:"mb-3"},K=t("label",{for:"due_date",class:"form-label"},"到期日",-1),Q=t("span",{class:"fw-light",style:{color:"#FF0000","font-size":"0.8rem"}},"*必填",-1),W=["min"],X={class:"mb-3"},Z=t("label",{for:"percent",class:"form-label"},"折扣百分比",-1),tt=t("span",{class:"fw-light",style:{color:"#FF0000","font-size":"0.8rem"}},"*必填；百分比範圍 0-100",-1),ot={class:"mb-3"},et={class:"form-check"},st=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),nt={class:"modal-footer"},at=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function lt(o,e,c,u,s,n){return d(),i("div",O,[t("div",S,[t("div",z,[t("div",N,[t("h5",P,[c.status==="new"?(d(),i("span",U,"新增優惠卷")):(d(),i("span",V,"編輯優惠卷"))]),E]),t("div",T,[t("div",B,[t("div",R,[t("div",j,[J,q,r(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":e[0]||(e[0]=a=>s.newCoupon.title=a)},null,512),[[_,s.newCoupon.title]])]),t("div",A,[I,G,r(t("input",{id:"code",type:"text",class:"form-control",placeholder:"請輸入優惠碼","onUpdate:modelValue":e[1]||(e[1]=a=>s.newCoupon.code=a)},null,512),[[_,s.newCoupon.code]])]),t("div",H,[K,Q,r(t("input",{id:"due_date",type:"date",class:"form-control",placeholder:"請輸入到期日","onUpdate:modelValue":e[2]||(e[2]=a=>s.newCoupon.due_date=a),min:n.minDate()},null,8,W),[[_,s.newCoupon.due_date]])]),t("div",X,[Z,tt,r(t("input",{id:"percent",type:"number",class:"form-control",min:"0",max:"100",placeholder:"請輸入折扣百分比","onUpdate:modelValue":e[3]||(e[3]=a=>s.newCoupon.percent=a)},null,512),[[_,s.newCoupon.percent,void 0,{number:!0}]])]),t("div",ot,[t("div",et,[r(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[4]||(e[4]=a=>s.newCoupon.is_enabled=a)},null,512),[[D,s.newCoupon.is_enabled]]),st])])])])]),t("div",nt,[at,t("button",{type:"button",class:"btn btn-primary",onClick:e[5]||(e[5]=(...a)=>n.handleSubmit&&n.handleSubmit(...a))}," 確認 ")])])])],512)}const dt=C(L,[["render",lt]]),it={props:{coupon:Object,on_finish:Function},data(){return{}},methods:{show(){this.modal.show()},hide(){this.modal.hide()},async handleRemove(){try{await f({method:"delete",url:`https://vue3-course-api.hexschool.io/v2/api/catboxy/admin/coupon/${this.coupon.id}`}).catch(o=>{throw o.response.data.message}),this.modal.hide(),this.$emit("on_finish")}catch(o){alert(o)}}},async mounted(){this.modal=new v(this.$refs.modal)}},ct={ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},ut={class:"modal-dialog"},rt={class:"modal-content bcoupon-0"},ht=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"刪除優惠券")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),pt={class:"modal-body"},_t={class:"text-danger"},mt={class:"modal-footer"},bt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ft(o,e,c,u,s,n){return d(),i("div",ct,[t("div",ut,[t("div",rt,[ht,t("div",pt,[y(" 是否刪除 "),t("strong",_t,p(c.coupon.title),1),y(" 優惠券(刪除後將無法恢復)。 ")]),t("div",mt,[bt,t("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=(...a)=>n.handleRemove&&n.handleRemove(...a))}," 確認刪除 ")])])])],512)}const Ct=C(it,[["render",ft]]),yt={data(){return{status:"",coupons:[],pagination:{total_pages:1,current_page:1,has_pre:!1,has_next:!1,category:""},coupon:{}}},components:{CPagination:$,CModalCouponsDelete:Ct,CModalCouponsEdit:dt},methods:{...k(F,["setLoader"]),addCoupon(){this.status="new",this.coupon={},this.$refs.adminCouponModal.show()},editCoupon(o){this.status="edit",this.coupon=JSON.parse(JSON.stringify(o)),this.$refs.adminCouponModal.show()},deleteCoupon(o){this.coupon=o,this.$refs.adminDeleteCouponModal.show()},async getCoupons(o){try{this.setLoader(!0);const e=await f({method:"get",url:"https://vue3-course-api.hexschool.io/v2/api/catboxy/admin/coupons",params:{page:o||this.pagination.current_page}});this.coupons=e.data.coupons,this.pagination=e.data.pagination,this.setLoader(!1)}catch(e){alert(e.response.data.message)}},getDate(o){return h.unix(o).format("YYYY/MM/DD")}},async mounted(){this.setLoader(!0),await this.getCoupons(),this.setLoader(!1)}},gt={class:"container"},vt={class:"row mb-2"},wt=t("div",{class:"col-8"},[t("span",{style:{"font-size":"1.5rem"}},"後台優惠碼一覽")],-1),xt={class:"col text-end"},Mt={class:"text-center"},$t={class:"row"},Dt={class:"col-12"},kt={class:"table align-middle"},Yt=t("thead",null,[t("tr",null,[t("th",null,"名稱"),t("th",null,"優惠碼"),t("th",null,"折扣百分比"),t("th",null,"到期日"),t("th",null,"是否啟用"),t("th",null,"編輯")])],-1),Ft={key:0},Lt={key:1},Ot={class:"btn-group btn-group-sm"},St=["onClick"],zt=["onClick"],Nt={class:"row"},Pt={class:"col-12"};function Ut(o,e,c,u,s,n){const a=m("CModalCouponsEdit"),w=m("CModalCouponsDelete"),x=m("CPagination");return d(),i(g,null,[b(a,{coupon:s.coupon,onOn_finish:n.getCoupons,status:s.status,ref:"adminCouponModal"},null,8,["coupon","onOn_finish","status"]),b(w,{coupon:s.coupon,onOn_finish:n.getCoupons,ref:"adminDeleteCouponModal"},null,8,["coupon","onOn_finish"]),t("div",gt,[t("div",vt,[wt,t("div",xt,[t("button",{type:"button",class:"btn btn-outline-primary",onClick:e[0]||(e[0]=(...l)=>n.addCoupon&&n.addCoupon(...l))}," 新增優惠券 ")])]),t("div",Mt,[t("div",$t,[t("div",Dt,[t("table",kt,[Yt,t("tbody",null,[(d(!0),i(g,null,Y(s.coupons,l=>(d(),i("tr",{key:l.id},[t("td",null,p(l.title),1),t("td",null,p(l.code),1),t("td",null,p(l.percent)+"%",1),t("td",null,p(n.getDate(l.due_date)),1),t("td",null,[l.is_enabled?(d(),i("span",Ft,"啟用")):(d(),i("span",Lt,"未啟用"))]),t("td",null,[t("div",Ot,[t("button",{type:"button",class:"btn btn-outline-primary",onClick:M=>n.editCoupon(l)}," 編輯 ",8,St),t("button",{type:"button",class:"btn btn-outline-danger",onClick:M=>n.deleteCoupon(l)}," 刪除 ",8,zt)])])]))),128))])])])]),t("div",Nt,[t("div",Pt,[b(x,{total_pages:s.pagination.total_pages,onOn_page:n.getCoupons},null,8,["total_pages","onOn_page"])])])])])],64)}const Rt=C(yt,[["render",Ut]]);export{Rt as default};
