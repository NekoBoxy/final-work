import{a as b}from"./axios-bff3f665.js";import{h as O}from"./moment-fbc5633a.js";import{C as x}from"./CPagination-79544886.js";import{_ as f,M as v,o as d,a as n,b as e,i as y,t as o,F as h,f as g,m as $,r as m,e as p,u as L}from"./index-d155b768.js";const M={props:{order:Object,on_finish:Function},data(){return{}},methods:{show(){this.modal.show()},hide(){this.modal.hide()},async handleRemove(){try{await b({method:"delete",url:`https://vue3-course-api.hexschool.io/v2/api/catboxy/admin/order/${this.order.id}`}).catch(t=>{throw t.response.data.message}),this.modal.hide(),this.$emit("on_finish")}catch(t){alert(t)}}},async mounted(){this.modal=new v(this.$refs.modal)}},D={ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},P={class:"modal-dialog"},Y={class:"modal-content border-0"},F=e("div",{class:"modal-header bg-danger text-white"},[e("h5",{id:"delProductModalLabel",class:"modal-title"},[e("span",null,"刪除訂單")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),A={class:"modal-body"},N={class:"text-danger"},S={class:"modal-footer"},V=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function j(t,l,_,w,s,a){return d(),n("div",D,[e("div",P,[e("div",Y,[F,e("div",A,[y(" 是否刪除 "),e("strong",N,o(_.order.id),1),y(" 訂單(刪除後將無法恢復)。 ")]),e("div",S,[V,e("button",{type:"button",class:"btn btn-danger",onClick:l[0]||(l[0]=(...r)=>a.handleRemove&&a.handleRemove(...r))}," 確認刪除 ")])])])],512)}const B=f(M,[["render",j]]),I={props:{order:{type:Object,default(){return{products:{},user:{}}}},on_update:Function},data(){return{modal:null,newOrder:{products:{},user:{}}}},watch:{order(t){this.newOrder={...t}}},methods:{handlePaidChange(t){this.newOrder.is_paid=t.target.checked},handleSubmit(){this.$emit("on_update",this.newOrder),this.modal.hide()},show(){this.modal.show()},hide(){this.modal.hide()},getDate(t){return O(t*1e3).format("YYYY/MM/DD")}},async mounted(){this.modal=new v(this.$refs.modal)}},R={class:"modal fade",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},q={class:"modal-dialog modal-xl",role:"document"},z={class:"modal-content border-0"},E=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),T={class:"modal-body",style:{"text-align":"left"}},G={class:"row"},H={class:"col-sm-4"},J=e("h4",null,"用戶資料",-1),K={class:"table"},Q=e("th",{scope:"row"},"姓名",-1),U=e("th",{scope:"row"},"信箱",-1),W=e("th",{scope:"row"},"電話",-1),X=e("th",{scope:"row"},"地址",-1),Z={class:"col-sm-8"},ee=e("h4",null,"訂單細節",-1),te={class:"table"},se=e("th",{scope:"row"},"訂單編號",-1),oe=e("th",{scope:"row"},"下單時間",-1),ae=e("th",{scope:"row"},"付款時間",-1),de={key:0},ne={key:1},le=e("th",{scope:"row"},"付款狀態",-1),re={key:0},ie={key:1},ce=e("th",{scope:"row"},"總金額",-1),he=e("h4",null,"選購商品",-1),_e={class:"table"},ue={scope:"row"},me={class:"d-flex justify-content-end"},pe={class:"form-check"},be=["checked"],ge={class:"form-check-label",for:"is_paid"},fe={key:0},we={key:1},ye={class:"modal-footer"},Oe=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ve(t,l,_,w,s,a){return d(),n("div",R,[e("div",q,[e("div",z,[E,e("div",T,[e("div",G,[e("div",H,[J,e("table",K,[e("tbody",null,[e("tr",null,[Q,e("td",null,o(s.newOrder.user.name),1)]),e("tr",null,[U,e("td",null,o(s.newOrder.user.email),1)]),e("tr",null,[W,e("td",null,o(s.newOrder.user.tel),1)]),e("tr",null,[X,e("td",null,o(s.newOrder.user.address),1)])])])]),e("div",Z,[ee,e("table",te,[e("tbody",null,[e("tr",null,[se,e("td",null,o(s.newOrder.id),1)]),e("tr",null,[oe,e("td",null,o(a.getDate(s.newOrder.create_at)),1)]),e("tr",null,[ae,e("td",null,[s.newOrder.is_paid&&s.newOrder.paid_date?(d(),n("span",de,o(a.getDate(s.newOrder.paid_date)),1)):(d(),n("span",ne,"無紀錄"))])]),e("tr",null,[le,e("td",null,[s.newOrder.is_paid?(d(),n("span",re,"已付款")):(d(),n("span",ie,"未付款"))])]),e("tr",null,[ce,e("td",null,o(new Intl.NumberFormat().format(s.newOrder.total)),1)])])]),he,e("table",_e,[e("tbody",null,[(d(!0),n(h,null,g(s.newOrder.products,(r,u)=>(d(),n("tr",{key:u},[e("th",ue,o(r.product.title),1),e("td",null,o(r.qty)+" "+o(r.product.unit),1),e("td",null,o(new Intl.NumberFormat().format(r.total)),1)]))),128))])]),e("div",me,[e("div",pe,[e("input",{class:"form-check-input",type:"checkbox",value:"",id:"is_paid",onChange:l[0]||(l[0]=(...r)=>a.handlePaidChange&&a.handlePaidChange(...r)),checked:s.newOrder.is_paid},null,40,be),e("label",ge,[s.newOrder.is_paid?(d(),n("span",fe,"已付款")):(d(),n("span",we,"未付款"))])])])])])]),e("div",ye,[Oe,e("button",{type:"button",class:"btn btn-primary",onClick:l[1]||(l[1]=(...r)=>a.handleSubmit&&a.handleSubmit(...r))}," 修改 ")])])])],512)}const ke=f(I,[["render",ve]]),Ce={data(){return{orders:[],order:{},pagination:{total_pages:"",current_page:1,has_pre:!1,has_next:!1,category:""}}},components:{CPagination:x,CModalOrderList:ke,CModalOrderDelete:B},methods:{...$(L,["setLoader"]),showOrder(t){this.order=t,this.$refs.CModalOrderList.show()},deleteOrder(t){this.order=t,this.$refs.CModalOrderDelete.show()},async handlePaidChange(t){this.setLoader(!0),t.is_paid=!t.is_paid,await this.updateOrder(t),this.setLoader(!1)},async updateOrder(t){try{this.setLoader(!0),this.order=t,await b({method:"put",url:`https://vue3-course-api.hexschool.io/v2/api/catboxy/admin/order/${this.order.id}`,data:{data:this.order}}),await this.getAllOrders(),this.setLoader(!1)}catch(l){alert(l.response.data.message)}},async getAllOrders(t){try{this.setLoader(!0);const l=await b({method:"get",url:"https://vue3-course-api.hexschool.io/v2/api/catboxy/admin/orders",params:{page:t||this.pagination.current_page}});this.orders=l.data.orders,this.pagination=l.data.pagination,this.setLoader(!1)}catch(l){alert(l.response.data.message)}},getDate(t){return O.unix(t).format("YYYY/MM/DD")}},async mounted(){this.setLoader(!0),await this.getAllOrders(),this.setLoader(!1)}},xe={class:"container"},$e={class:"row"},Le=e("div",{class:"col-12"},[e("span",{style:{"font-size":"1.5rem"}},"後台訂單一覽")],-1),Me={class:"col-12"},De={class:"table align-middle"},Pe=e("thead",null,[e("tr",null,[e("th",null,"購買時間"),e("th",null,"信箱"),e("th",null,"購買項目"),e("th",null,"應付金額"),e("th",null,"是否付款"),e("th",null,"編輯")])],-1),Ye={class:"form-check form-switch"},Fe=["onChange","checked"],Ae={class:"form-check-label",for:"is_paid"},Ne={key:0},Se={key:1},Ve={class:"btn-group btn-group-sm"},je=["onClick"],Be=["onClick"],Ie={class:"row"},Re={class:"col-12"};function qe(t,l,_,w,s,a){const r=m("CModalOrderList"),u=m("CModalOrderDelete"),k=m("CPagination");return d(),n(h,null,[p(r,{order:s.order,onOn_update:a.updateOrder,ref:"CModalOrderList"},null,8,["order","onOn_update"]),p(u,{order:s.order,onOn_finish:a.getAllOrders,ref:"CModalOrderDelete"},null,8,["order","onOn_finish"]),e("div",xe,[e("div",$e,[Le,e("div",Me,[e("table",De,[Pe,e("tbody",null,[(d(!0),n(h,null,g(s.orders,i=>(d(),n("tr",{key:i.id},[e("td",null,o(a.getDate(i.create_at)),1),e("td",null,o(i.user.email),1),e("td",null,[(d(!0),n(h,null,g(i.products,(c,C)=>(d(),n("div",{key:C},o(c.product.title)+" 數量： "+o(c.qty)+" "+o(c.product.unit),1))),128))]),e("td",null,o(new Intl.NumberFormat().format(i.total)),1),e("td",null,[e("div",Ye,[e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"is_paid",onChange:c=>a.handlePaidChange(i),checked:i.is_paid},null,40,Fe),e("label",Ae,[i.is_paid?(d(),n("span",Ne,"已付款")):(d(),n("span",Se,"未付款"))])])]),e("td",null,[e("div",Ve,[e("button",{type:"button",class:"btn btn-outline-primary",onClick:c=>a.showOrder(i)}," 檢視 ",8,je),e("button",{type:"button",class:"btn btn-outline-danger",onClick:c=>a.deleteOrder(i)}," 刪除 ",8,Be)])])]))),128))])])])]),e("div",Ie,[e("div",Re,[p(k,{total_pages:s.pagination.total_pages,onOn_page:a.getAllOrders},null,8,["total_pages","onOn_page"])])])])],64)}const He=f(Ce,[["render",qe]]);export{He as default};
