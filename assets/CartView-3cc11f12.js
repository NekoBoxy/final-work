import{C as N,a as I}from"./CFooter-d30409ae.js";import{_ as F,m as S,T as h,r as f,o as v,a as y,b as t,e as a,q as P,F as x,f as q,w,u as j,n as i,t as p,l as T,s as $,p as V,h as B,i as C}from"./index-a5e9ff6a.js";import{a as m}from"./axios-bff3f665.js";import{u as E}from"./cart-2066dc92.js";const M={components:{CNavbar:N,CFooter:I},data(){return{currentStep:1,step:"",carts:[],total:0,final_total:0,orderId:""}},methods:{...S(E,["updateNum"]),...S(j,["setLoader"]),async getCart(){try{this.setLoader(!0);const s=await m({method:"get",url:"https://vue3-course-api.hexschool.io/v2/api/catboxy/cart"});this.carts=s.data.data.carts,this.final_total=Math.ceil(s.data.data.final_total),this.total=s.data.data.total,this.setLoader(!1)}catch(s){const l=s.response.data.message;alert(l)}},async updateCart(s,l,_){try{this.qty=Math.abs(parseInt(_,10)),this.qty=this.qty===0?1:this.qty,this.carts=this.carts.map(u=>(u.id===s&&(u.qty=this.qty),u)),this.setLoader(!0),await m({method:"put",url:`https://vue3-course-api.hexschool.io/v2/api/catboxy/cart/${s}`,data:{data:{product_id:l,qty:this.qty}}}),await this.getCart(),this.setLoader(!1)}catch(u){alert(u.response.data.message)}},async deleteCart(s,l){try{this.setLoader(!0),await m({method:"delete",url:`https://vue3-course-api.hexschool.io/v2/api/catboxy/cart/${s}`,data:{data:{id:l}}}),await this.getCart(),await this.updateNum(),this.setLoader(!1)}catch(_){alert(_.response.data.message)}},checkMobilePhone(s){return/^09[0-9]{8}$/.test(s)?!0:"需要正確的電話號碼"},async handleCouponSubmit(s){try{this.setLoader(!0),await m({method:"post",url:"https://vue3-course-api.hexschool.io/v2/api/catboxy/coupon",data:{data:{code:s.code}}}),this.$refs.couponForm.resetForm(),await this.getCart(),this.setLoader(!1)}catch(l){alert(l.response.data.message)}},async handleConfirmSubmit(){this.setLoader(!0),new h(this.$refs["profile-tab"]).show(),this.$router.push({path:"/cart",query:{step:"profile"}}),document.documentElement.scrollTop=0,this.setLoader(!1),this.currentStep=2},async handleProfileSubmit(s){try{this.setLoader(!0);const l=await m({method:"post",url:"https://vue3-course-api.hexschool.io/v2/api/catboxy/order",data:{data:{user:{email:s.email,name:s.name,tel:s.mobilePhone,address:s.address},message:s.message}}});this.orderId=l.data.orderId,this.$refs.profileForm.resetForm(),await this.getCart(),await this.updateNum(),new h(this.$refs["pay-tab"]).show(),this.$router.push({path:"/cart",query:{step:"pay",orderId:this.orderId}}),document.documentElement.scrollTop=0,this.setLoader(!1),this.currentStep=3}catch(l){alert(l.response.data.message)}},async handlePaySubmit(){try{this.setLoader(!0),await m({method:"post",url:`https://vue3-course-api.hexschool.io/v2/api/catboxy/pay/${this.orderId}`}),this.$refs.payForm.resetForm(),new h(this.$refs["success-tab"]).show(),this.$router.push({path:"/cart",query:{step:"success"}}),document.documentElement.scrollTop=0,this.setLoader(!1),this.currentStep=4}catch(s){alert(s.response.data.message)}}},async mounted(){this.setLoader(!0),await this.getCart(),this.step=this.$route.query.step,this.step==="profile"?(new h(this.$refs["profile-tab"]).show(),this.currentStep=2):this.step==="pay"?(new h(this.$refs["pay-tab"]).show(),this.orderId=this.$route.query.orderId,this.currentStep=3):this.step==="success"?(new h(this.$refs["success-tab"]).show(),this.currentStep=4):(new h(this.$refs["confirm-tab"]).show(),this.currentStep=1),this.setLoader(!1)}},o=s=>(V("data-v-65db816b"),s=s(),B(),s),U={class:"wrapper"},z={class:"container container-steps d-flex justify-content-center"},D={class:"progress-container"},A={class:"container"},G={class:"row"},H={class:"col"},J={class:"nav nav-tabs",id:"myTab",role:"tablist",style:{display:"none"}},K={class:"nav-item",role:"presentation"},O={class:"nav-link active",id:"confirm-tab",ref:"confirm-tab","data-bs-toggle":"tab","data-bs-target":"#confirm-tab-pane",type:"button",role:"tab","aria-controls":"confirm-tab-pane","aria-selected":"true"},Q={class:"nav-item",role:"presentation"},R={class:"nav-link",id:"profile-tab",ref:"profile-tab","data-bs-toggle":"tab","data-bs-target":"#profile-tab-pane",type:"button",role:"tab","aria-controls":"profile-tab-pane","aria-selected":"false"},W={class:"nav-item",role:"presentation"},X={class:"nav-link",id:"pay-tab",ref:"pay-tab","data-bs-toggle":"tab","data-bs-target":"#pay-tab-pane",type:"button",role:"tab","aria-controls":"pay-tab-pane","aria-selected":"false"},Y={class:"nav-item",role:"presentation"},Z={class:"nav-link",id:"success-tab",ref:"success-tab","data-bs-toggle":"tab","data-bs-target":"#success-tab-pane",type:"button",role:"tab","aria-controls":"success-tab-pane","aria-selected":"false"},tt={class:"tab-content mb-3",id:"myTabContent"},et={class:"tab-pane fade show active",id:"confirm-tab-pane",role:"tabpanel","aria-labelledby":"confirm-tab",tabindex:"0"},st=o(()=>t("div",{class:"my-3 d-flex justify-content-center"},[t("h5",null,"確認訂單資訊")],-1)),at={class:"row"},ot={class:"col-12"},lt={class:"table-main"},ct=o(()=>t("thead",null,[t("tr",null,[t("th",{scope:"col",class:"table-pc"},"商品圖片"),t("th",{scope:"col"},[t("span",{class:"table-mobile"},"品名"),t("span",{class:"table-pc"},"商品名稱")]),t("th",{scope:"col",class:"table-pc"},"原價"),t("th",{scope:"col"},"單價"),t("th",{scope:"col"},[t("span",{class:"table-mobile"},"數量"),t("span",{class:"table-pc"},"數量 / 單位")]),t("th",{scope:"col"},[t("span",{class:"table-mobile"},"金額"),t("span",{class:"table-pc"},"金額小計")]),t("th",{scope:"col"},"取消")])],-1)),it={class:"align-items-center"},rt={class:"table-pc"},nt=["src"],dt=["title"],ht=["title"],pt={class:"table-pc"},ut={class:"d-flex d-lg-none mb-3",style:{"min-width":"110px"}},bt=["onBlur","onUpdate:modelValue"],mt={class:"input-group mb-3 d-none d-lg-flex",style:{"max-width":"150px"}},_t=["onBlur","onUpdate:modelValue"],ft={class:"input-group-text table-pc"},vt=["onClick"],yt={class:"row"},gt={class:"row"},xt=o(()=>t("label",{for:"staticTotal",class:"col-12 col-md-4 col-lg-3 col-form-label"},"訂單金額小計：",-1)),wt={class:"col-12 col-md-8 col-lg-9"},Ct={class:"mb-3"},St=["value"],qt={class:"row"},Tt=o(()=>t("label",{for:"code",class:"col-12 col-md-4 col-lg-3 col-form-label"},"使用優惠碼：",-1)),$t={class:"col-12 col-sm-6 col-md-3 col-lg-4 mb-3"},kt=o(()=>t("div",{class:"col-12 col-sm-6 col-md-5 col-lg-5 mb-3"},[t("button",{type:"submit",class:"btn btn-primary"}," 套用優惠碼 ")],-1)),Lt={class:"row"},Nt=o(()=>t("label",{for:"staticTotal",class:"col-12 col-md-4 col-lg-3 col-form-label"},"您的優惠折扣：",-1)),It={class:"col-12 col-md-8 col-lg-9"},Ft={class:"mb-3"},Pt=["value"],jt={class:"row"},Vt=o(()=>t("label",{for:"staticTotal",class:"col-12 col-md-4 col-lg-3 col-form-label"},"折扣後訂單總金額：",-1)),Bt={class:"col-12 col-md-8 col-lg-9"},Et={class:"mb-3"},Mt=["value"],Ut={class:"text-end"},zt={class:"tab-pane fade",id:"profile-tab-pane",role:"tabpanel","aria-labelledby":"profile-tab",tabindex:"0"},Dt=o(()=>t("div",{class:"my-3 d-flex justify-content-center"},[t("h5",null,"填寫收件資訊")],-1)),At={class:"row"},Gt={class:"col-12 justify-content-center"},Ht={class:"mb-3"},Jt=o(()=>t("label",{for:"name",class:"form-label"},"收件人姓名",-1)),Kt={class:"mb-3"},Ot=o(()=>t("label",{for:"mobilePhone",class:"form-label"},"收件人手機號碼",-1)),Qt={class:"mb-3"},Rt=o(()=>t("label",{for:"email",class:"form-label"},"Email",-1)),Wt={class:"mb-3"},Xt=o(()=>t("label",{for:"address",class:"form-label"},"收件人地址",-1)),Yt={class:"mb-3"},Zt=o(()=>t("label",{for:"message",class:"form-label"},"留言",-1)),te=o(()=>t("div",{class:"text-end"},[t("button",{type:"submit",class:"btn btn-primary"}," 送出訂單 ")],-1)),ee={class:"tab-pane fade",id:"pay-tab-pane",role:"tabpanel","aria-labelledby":"pay-tab",tabindex:"0"},se=o(()=>t("div",{class:"my-3 d-flex justify-content-center"},[t("h5",null,"填寫信用卡資訊")],-1)),ae={class:"row"},oe={class:"col-12 justify-content-center"},le={class:"mb-3"},ce=o(()=>t("label",{for:"creditCard",class:"form-label"},"信用卡號",-1)),ie=o(()=>t("div",{class:"row"},[t("div",{class:"col-md-12"},[t("label",{for:"firstName",class:"form-label"},"持卡人姓名")])],-1)),re={class:"row"},ne={class:"mb-3 col-md-6"},de={class:"mb-3 col-md-6"},he=o(()=>t("div",{class:"row"},[t("div",{class:"col-md-12"},[t("label",{for:"month",class:"form-label"},"有效期限")])],-1)),pe={class:"row"},ue={class:"mb-3 col-md-6"},be={class:"mb-3 col-md-6"},me={class:"mb-3"},_e=o(()=>t("label",{for:"security",class:"form-label"},"安全碼",-1)),fe=o(()=>t("div",{class:"text-end"},[t("button",{type:"submit",class:"btn btn-primary"}," 付款 ")],-1)),ve=o(()=>t("div",{class:"tab-pane fade",id:"success-tab-pane",role:"tabpanel","aria-labelledby":"success-tab",tabindex:"0"},[t("div",{class:"my-3 d-flex justify-content-center"},[t("h5",null,"完成訂購")]),t("div",{class:"d-flex justify-content-center"},[C("交易已完成，您可於三至五分鐘後至電子信箱收取訂單資訊郵件。"),t("br"),C(" 謝謝您的購買與支持，小幫手正快馬加鞭包裝與出貨中。"),t("br"),C(" 關於訂單若有任何需求，請洽0800-000-000，將由專人為您服務。 ")])],-1));function ye(s,l,_,u,n,d){const k=f("CNavbar"),c=f("v-field"),g=f("v-form"),r=f("error-message"),L=f("CFooter");return v(),y(x,null,[t("div",U,[a(k),t("div",z,[t("div",D,[t("div",{id:"progress",class:"progress",style:P({width:`${(n.currentStep-1)*33.3}%`})},null,4),(v(),y(x,null,q(4,e=>t("div",{class:i(["circle",{active:n.currentStep===e}]),key:e},p(e),3)),64))])]),t("div",A,[t("div",G,[t("div",H,[t("ul",J,[t("li",K,[t("button",O,"確認訂單",512)]),t("li",Q,[t("button",R,"收件資訊",512)]),t("li",W,[t("button",X,"付款資訊",512)]),t("li",Y,[t("button",Z,"完成訂購",512)])]),t("div",tt,[t("div",et,[st,t("div",at,[t("div",ot,[t("table",lt,[ct,t("tbody",it,[(v(!0),y(x,null,q(n.carts,e=>(v(),y("tr",{key:e.id},[t("td",rt,[t("img",{src:e.product.imageUrl,style:{"object-fit":"cover",height:"150px","max-width":"150px"},alt:"listImg",srcset:""},null,8,nt)]),t("td",null,[t("div",{class:"table-mobile text-truncate",style:{width:"100px"},title:e.product.title},p(e.product.title),9,dt),t("div",{class:"table-pc text-truncate",style:{width:"250px"},title:e.product.title},p(e.product.title),9,ht)]),t("td",pt,p(e.product.origin_price),1),t("td",null,p(e.product.price),1),t("td",null,[t("div",ut,[T(t("input",{min:"1",type:"number",class:"form-control",step:"1",onBlur:b=>d.updateCart(e.id,e.product.id,e.qty),"onUpdate:modelValue":b=>e.qty=b},null,40,bt),[[$,e.qty,void 0,{number:!0}]])]),t("div",mt,[T(t("input",{min:"1",type:"number",class:"form-control",step:"1",onBlur:b=>d.updateCart(e.id,e.product.id,e.qty),"onUpdate:modelValue":b=>e.qty=b},null,40,_t),[[$,e.qty,void 0,{number:!0}]]),t("span",ft,p(e.product.unit),1)])]),t("td",null,p(e.total)+" 元",1),t("td",null,[t("button",{type:"button",class:"btn btn-danger btn-sm",onClick:b=>d.deleteCart(e.id,e.product.id)},"刪除",8,vt)])]))),128))])])])]),t("div",yt,[a(g,{onSubmit:d.handleCouponSubmit,ref:"couponForm",class:"col"},{default:w(()=>[t("div",gt,[xt,t("div",wt,[t("div",Ct,[t("input",{type:"text",readonly:"",class:"form-control-plaintext",id:"staticTotal",value:`${n.total} 元`},null,8,St)])])]),t("div",qt,[Tt,t("div",$t,[a(c,{id:"code",name:"code",type:"text",class:"form-control",placeholder:"請輸入優惠碼"})]),kt]),t("div",Lt,[Nt,t("div",It,[t("div",Ft,[t("input",{type:"text",readonly:"",class:"form-control-plaintext",id:"staticTotal",value:n.final_total!==n.total?`${parseInt(100*n.final_total/n.total,10)} ％`:"無"},null,8,Pt)])])]),t("div",jt,[Vt,t("div",Bt,[t("div",Et,[t("input",{type:"text",readonly:"",class:"form-control-plaintext",id:"staticTotal",value:`${n.final_total} 元`},null,8,Mt)])])]),t("div",Ut,[t("button",{type:"button",class:"btn btn-primary",onClick:l[0]||(l[0]=(...e)=>d.handleConfirmSubmit&&d.handleConfirmSubmit(...e))},"下一步")])]),_:1},8,["onSubmit"])])]),t("div",zt,[Dt,t("div",At,[t("div",Gt,[a(g,{onSubmit:d.handleProfileSubmit,ref:"profileForm",class:"col"},{default:w(({errors:e})=>[t("div",Ht,[Jt,a(c,{id:"name",name:"name",type:"text",class:i(["form-control",{"is-invalid":e.name}]),placeholder:"請輸入姓名",rules:"required"},null,8,["class"]),a(r,{name:"name",class:"invalid-feedback"})]),t("div",Kt,[Ot,a(c,{id:"mobilePhone",name:"mobilePhone",type:"tel",class:i(["form-control",{"is-invalid":e.mobilePhone}]),placeholder:"請輸入手機號碼",rules:d.checkMobilePhone},null,8,["class","rules"]),a(r,{name:"mobilePhone",class:"invalid-feedback"})]),t("div",Qt,[Rt,a(c,{id:"email",name:"email",type:"email",class:i(["form-control",{"is-invalid":e.email}]),placeholder:"請輸入 Email",rules:"email|required"},null,8,["class"]),a(r,{name:"email",class:"invalid-feedback"})]),t("div",Wt,[Xt,a(c,{id:"address",name:"address",type:"text",class:i(["form-control",{"is-invalid":e.address}]),placeholder:"請輸入地址",rules:"required"},null,8,["class"]),a(r,{name:"address",class:"invalid-feedback"})]),t("div",Yt,[Zt,a(c,{id:"message",name:"message",class:"form-control",cols:"30",rows:"10",rules:"required",as:"textarea"})]),te]),_:1},8,["onSubmit"])])])]),t("div",ee,[se,t("div",ae,[t("div",oe,[a(g,{onSubmit:d.handlePaySubmit,ref:"payForm",class:"col"},{default:w(({errors:e})=>[t("div",le,[ce,a(c,{id:"creditCard",name:"creditCard",type:"text",class:i(["form-control",{"is-invalid":e.creditCard}]),placeholder:"請輸入信用卡號",rules:{required:!0,regex:/^\d{4}-\d{4}-\d{4}-\d{4}$/}},null,8,["class"]),a(r,{name:"creditCard",class:"invalid-feedback"})]),ie,t("div",re,[t("div",ne,[a(c,{id:"firstName",name:"firstName",type:"text",class:i(["form-control",{"is-invalid":e.firstName}]),placeholder:"請輸入姓氏",rules:"required"},null,8,["class"]),a(r,{name:"firstName",class:"invalid-feedback"})]),t("div",de,[a(c,{id:"lastName",name:"lastName",type:"text",class:i(["form-control",{"is-invalid":e.lastName}]),placeholder:"請輸入名字",rules:"required"},null,8,["class"]),a(r,{name:"lastName",class:"invalid-feedback"})])]),he,t("div",pe,[t("div",ue,[a(c,{id:"month",name:"month",type:"text",class:i(["form-control",{"is-invalid":e.month}]),placeholder:"請輸入月份",rules:"required"},null,8,["class"]),a(r,{name:"month",class:"invalid-feedback"})]),t("div",be,[a(c,{id:"year",name:"year",type:"text",class:i(["form-control",{"is-invalid":e.year}]),placeholder:"請輸入年份",rules:"required"},null,8,["class"]),a(r,{name:"year",class:"invalid-feedback"})])]),t("div",me,[_e,a(c,{id:"security",name:"security",type:"text",class:i(["form-control",{"is-invalid":e.security}]),placeholder:"請輸入安全碼",rules:"required"},null,8,["class"]),a(r,{name:"security",class:"invalid-feedback"})]),fe]),_:1},8,["onSubmit"])])])]),ve])])])])]),a(L)],64)}const Se=F(M,[["render",ye],["__scopeId","data-v-65db816b"]]);export{Se as default};
