import{a as b}from"./axios-bff3f665.js";import{h as O}from"./moment-fbc5633a.js";import{C as x}from"./CPagination-bf0ce565.js";import{_ as w,M as v,o as d,a as l,e,g as f,t as o,F as _,f as g,r as p,b as m}from"./index-794ac18e.js";const $={props:{order:Object,on_finish:Function},data(){return{}},methods:{show(){this.modal.show()},hide(){this.modal.hide()},async handleRemove(){try{await b({method:"delete",url:`https://vue3-course-api.hexschool.io/v2/api/catboxy/admin/order/${this.order.id}`}).catch(t=>{throw t.response.data.message}),this.modal.hide(),this.$emit("on_finish")}catch(t){alert(t)}}},async mounted(){this.modal=new v(this.$refs.modal)}},M={ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},D={class:"modal-dialog"},L={class:"modal-content border-0"},P=e("div",{class:"modal-header bg-danger text-white"},[e("h5",{id:"delProductModalLabel",class:"modal-title"},[e("span",null,"刪除訂單")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Y={class:"modal-body"},A={class:"text-danger"},F={class:"modal-footer"},S=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function V(t,a,h,y,s,n){return d(),l("div",M,[e("div",D,[e("div",L,[P,e("div",Y,[f(" 是否刪除 "),e("strong",A,o(h.order.id),1),f(" 訂單(刪除後將無法恢復)。 ")]),e("div",F,[S,e("button",{type:"button",class:"btn btn-danger",onClick:a[0]||(a[0]=(...r)=>n.handleRemove&&n.handleRemove(...r))}," 確認刪除 ")])])])],512)}const j=w($,[["render",V]]),B={props:{order:{type:Object,default(){return{products:{},user:{}}}},on_update:Function},data(){return{modal:null,newOrder:{products:{},user:{}}}},watch:{order(t){this.newOrder={...t}}},methods:{handlePaidChange(t){this.newOrder.is_paid=t.target.checked},handleSubmit(){this.$emit("on_update",this.newOrder),this.modal.hide()},show(){this.modal.show()},hide(){this.modal.hide()},getDate(t){return O(t*1e3).format("YYYY/MM/DD")}},async mounted(){this.modal=new v(this.$refs.modal)}},N={class:"modal fade",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},R={class:"modal-dialog modal-xl",role:"document"},q={class:"modal-content border-0"},E=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),T={class:"modal-body",style:{"text-align":"left"}},z={class:"row"},G={class:"col-sm-4"},H=e("h4",null,"用戶資料",-1),I={class:"table"},J=e("th",{scope:"row"},"姓名",-1),K=e("th",{scope:"row"},"信箱",-1),Q=e("th",{scope:"row"},"電話",-1),U=e("th",{scope:"row"},"地址",-1),W={class:"col-sm-8"},X=e("h4",null,"訂單細節",-1),Z={class:"table"},ee=e("th",{scope:"row"},"訂單編號",-1),te=e("th",{scope:"row"},"下單時間",-1),se=e("th",{scope:"row"},"付款時間",-1),oe={key:0},ne={key:1},de=e("th",{scope:"row"},"付款狀態",-1),le={key:0},ae={key:1},re=e("th",{scope:"row"},"總金額",-1),ie=e("h4",null,"選購商品",-1),ce={class:"table"},he={scope:"row"},_e={class:"d-flex justify-content-end"},ue={class:"form-check"},pe=["checked"],me={class:"form-check-label",for:"is_paid"},be={key:0},ge={key:1},we={class:"modal-footer"},ye=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function fe(t,a,h,y,s,n){return d(),l("div",N,[e("div",R,[e("div",q,[E,e("div",T,[e("div",z,[e("div",G,[H,e("table",I,[e("tbody",null,[e("tr",null,[J,e("td",null,o(s.newOrder.user.name),1)]),e("tr",null,[K,e("td",null,o(s.newOrder.user.email),1)]),e("tr",null,[Q,e("td",null,o(s.newOrder.user.tel),1)]),e("tr",null,[U,e("td",null,o(s.newOrder.user.address),1)])])])]),e("div",W,[X,e("table",Z,[e("tbody",null,[e("tr",null,[ee,e("td",null,o(s.newOrder.id),1)]),e("tr",null,[te,e("td",null,o(n.getDate(s.newOrder.create_at)),1)]),e("tr",null,[se,e("td",null,[s.newOrder.is_paid&&s.newOrder.paid_date?(d(),l("span",oe,o(n.getDate(s.newOrder.paid_date)),1)):(d(),l("span",ne,"無紀錄"))])]),e("tr",null,[de,e("td",null,[s.newOrder.is_paid?(d(),l("span",le,"已付款")):(d(),l("span",ae,"未付款"))])]),e("tr",null,[re,e("td",null,o(s.newOrder.total),1)])])]),ie,e("table",ce,[e("tbody",null,[(d(!0),l(_,null,g(s.newOrder.products,(r,u)=>(d(),l("tr",{key:u},[e("th",he,o(r.product.title),1),e("td",null,o(r.qty)+" "+o(r.product.unit),1),e("td",null,o(r.total),1)]))),128))])]),e("div",_e,[e("div",ue,[e("input",{class:"form-check-input",type:"checkbox",value:"",id:"is_paid",onChange:a[0]||(a[0]=(...r)=>n.handlePaidChange&&n.handlePaidChange(...r)),checked:s.newOrder.is_paid},null,40,pe),e("label",me,[s.newOrder.is_paid?(d(),l("span",be,"已付款")):(d(),l("span",ge,"未付款"))])])])])])]),e("div",we,[ye,e("button",{type:"button",class:"btn btn-primary",onClick:a[1]||(a[1]=(...r)=>n.handleSubmit&&n.handleSubmit(...r))}," 修改付款狀態 ")])])])],512)}const Oe=w(B,[["render",fe]]),ve={data(){return{orders:[],order:{},pagination:{total_pages:"",current_page:1,has_pre:!1,has_next:!1,category:""}}},components:{CPagination:x,CModalOrderList:Oe,CModalOrderDelete:j},methods:{showOrder(t){this.order=t,this.$refs.CModalOrderList.show()},deleteOrder(t){this.order=t,this.$refs.CModalOrderDelete.show()},async handlePaidChange(t){t.is_paid=!t.is_paid,await this.updateOrder(t)},async updateOrder(t){this.order=t,await b({method:"put",url:`https://vue3-course-api.hexschool.io/v2/api/catboxy/admin/order/${this.order.id}`,data:{data:this.order}}).catch(a=>{alert(a.response.data.message)}),await this.getAllOrders()},async getAllOrders(t){const a=await b({method:"get",url:"https://vue3-course-api.hexschool.io/v2/api/catboxy/admin/orders",params:{page:t||this.pagination.current_page}}).catch(h=>{alert("error",h.message)});this.orders=a.data.orders,this.pagination=a.data.pagination},getDate(t){return O.unix(t).format("YYYY/MM/DD")}},async mounted(){await this.getAllOrders()}},ke={class:"row"},Ce={class:"col-12"},xe=e("div",null,[e("span",null,"檢視訂單 - 簡表")],-1),$e={class:"table align-middle"},Me=e("thead",null,[e("tr",null,[e("th",null,"購買時間"),e("th",null,"信箱"),e("th",null,"購買項目"),e("th",null,"應付金額"),e("th",null,"是否付款"),e("th",null,"編輯")])],-1),De={class:"form-check form-switch"},Le=["onChange","checked"],Pe={class:"form-check-label",for:"is_paid"},Ye={key:0},Ae={key:1},Fe={class:"btn-group btn-group-sm"},Se=["onClick"],Ve=["onClick"],je={class:"row"},Be={class:"col-12"};function Ne(t,a,h,y,s,n){const r=p("CModalOrderList"),u=p("CModalOrderDelete"),k=p("CPagination");return d(),l(_,null,[m(r,{order:s.order,onOn_update:n.updateOrder,ref:"CModalOrderList"},null,8,["order","onOn_update"]),m(u,{order:s.order,onOn_finish:n.getAllOrders,ref:"CModalOrderDelete"},null,8,["order","onOn_finish"]),e("div",ke,[e("div",Ce,[xe,e("table",$e,[Me,e("tbody",null,[(d(!0),l(_,null,g(s.orders,i=>(d(),l("tr",{key:i.id},[e("td",null,o(n.getDate(i.create_at)),1),e("td",null,o(i.user.email),1),e("td",null,[(d(!0),l(_,null,g(i.products,(c,C)=>(d(),l("div",{key:C},o(c.product.title)+" 數量： "+o(c.qty)+" "+o(c.product.unit),1))),128))]),e("td",null,o(i.total),1),e("td",null,[e("div",De,[e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"is_paid",onChange:c=>n.handlePaidChange(i),checked:i.is_paid},null,40,Le),e("label",Pe,[i.is_paid?(d(),l("span",Ye,"已付款")):(d(),l("span",Ae,"未付款"))])])]),e("td",null,[e("div",Fe,[e("button",{type:"button",class:"btn btn-outline-primary",onClick:c=>n.showOrder(i)}," 檢視 ",8,Se),e("button",{type:"button",class:"btn btn-outline-danger",onClick:c=>n.deleteOrder(i)}," 刪除 ",8,Ve)])])]))),128))])])])]),e("div",je,[e("div",Be,[m(k,{total_pages:s.pagination.total_pages,onOn_page:n.getAllOrders},null,8,["total_pages","onOn_page"])])])],64)}const ze=w(ve,[["render",Ne]]);export{ze as default};
