import{C as k,a as S}from"./CFooter-4691bcee.js";import{_ as q,m as N,T as m,r as u,o as v,a as y,b as a,e as t,F as x,f as F,w as g,t as h,l as P,q as I,n,p as E,h as V}from"./index-abb04135.js";import{a as b}from"./axios-bff3f665.js";import{u as B}from"./cart-4c1edb28.js";const j={components:{CNavbar:k,CFooter:S},data(){return{step:"",carts:null,total:0,final_total:0,orderId:""}},methods:{...N(B,["updateNum"]),async getCart(){const s=await b({method:"get",url:"https://vue3-course-api.hexschool.io/v2/api/catboxy/cart"});this.carts=s.data.data.carts,this.final_total=s.data.data.final_total,this.total=s.data.data.total},async updateCart(s,l,p){await b({method:"put",url:`https://vue3-course-api.hexschool.io/v2/api/catboxy/cart/${s}`,data:{data:{product_id:l,qty:p}}}),await this.getCart()},async deleteCart(s,l){await b({method:"delete",url:`https://vue3-course-api.hexschool.io/v2/api/catboxy/cart/${s}`,data:{data:{id:l}}}),await this.getCart(),await this.updateNum()},checkMobilePhone(s){return/^09[0-9]{8}$/.test(s)?!0:"需要正確的電話號碼"},async handleCouponSubmit(s){await b({method:"post",url:"https://vue3-course-api.hexschool.io/v2/api/catboxy/coupon",data:{data:{code:s.code}}}).catch(l=>{alert(l.response.data.message)}),this.$refs.couponForm.resetForm(),await this.getCart()},async handleConfirmSubmit(){new m(this.$refs["profile-tab"]).show(),this.$router.push({path:"/cart",query:{step:"profile"}}),document.documentElement.scrollTop=0},async handleProfileSubmit(s){const l=await b({method:"post",url:"https://vue3-course-api.hexschool.io/v2/api/catboxy/order",data:{data:{user:{email:s.email,name:s.name,tel:s.mobilePhone,address:s.address},message:s.message}}}).catch(w=>{alert(w.response.data.message)});this.orderId=l.data.orderId,this.$refs.profileForm.resetForm(),await this.getCart(),await this.updateNum(),new m(this.$refs["pay-tab"]).show(),this.$router.push({path:"/cart",query:{step:"pay",orderId:this.orderId}}),document.documentElement.scrollTop=0},async handlePaySubmit(){await b({method:"post",url:`https://vue3-course-api.hexschool.io/v2/api/catboxy/pay/${this.orderId}`}).catch(l=>{alert(l.response.data.message)}),this.$refs.payForm.resetForm(),new m(this.$refs["success-tab"]).show(),this.$router.push({path:"/cart",query:{step:"success"}}),document.documentElement.scrollTop=0}},async mounted(){this.getCart(),this.step=this.$route.query.step,this.step==="profile"?new m(this.$refs["profile-tab"]).show():this.step==="pay"?(new m(this.$refs["pay-tab"]).show(),this.orderId=this.$route.query.orderId):this.step==="success"?new m(this.$refs["success-tab"]).show():new m(this.$refs["confirm-tab"]).show()}},o=s=>(E("data-v-eaa421dd"),s=s(),V(),s),M={class:"container"},U={class:"row"},D={class:"col"},z={class:"nav nav-tabs",id:"myTab",role:"tablist"},A={class:"nav-item",role:"presentation"},L={class:"nav-link active",id:"confirm-tab",ref:"confirm-tab","data-bs-toggle":"tab","data-bs-target":"#confirm-tab-pane",type:"button",role:"tab","aria-controls":"confirm-tab-pane","aria-selected":"true"},G={class:"nav-item",role:"presentation"},H={class:"nav-link",id:"profile-tab",ref:"profile-tab","data-bs-toggle":"tab","data-bs-target":"#profile-tab-pane",type:"button",role:"tab","aria-controls":"profile-tab-pane","aria-selected":"false"},J={class:"nav-item",role:"presentation"},K={class:"nav-link",id:"pay-tab",ref:"pay-tab","data-bs-toggle":"tab","data-bs-target":"#pay-tab-pane",type:"button",role:"tab","aria-controls":"pay-tab-pane","aria-selected":"false"},O={class:"nav-item",role:"presentation"},Q={class:"nav-link",id:"success-tab",ref:"success-tab","data-bs-toggle":"tab","data-bs-target":"#success-tab-pane",type:"button",role:"tab","aria-controls":"success-tab-pane","aria-selected":"false"},R={class:"tab-content",id:"myTabContent"},W={class:"tab-pane fade show active",id:"confirm-tab-pane",role:"tabpanel","aria-labelledby":"confirm-tab",tabindex:"0"},X=o(()=>t("div",{class:"my-3"},[t("h5",null,"確認訂單資訊")],-1)),Y={class:"row"},Z={class:"col-12"},tt={class:"table"},st=o(()=>t("thead",null,[t("tr",null,[t("th",{scope:"col"},"資料序"),t("th",{scope:"col"},"商品圖片"),t("th",{scope:"col"},"商品名稱"),t("th",{scope:"col"},"原價"),t("th",{scope:"col"},"單價"),t("th",{scope:"col"},"數量 / 單位"),t("th",{scope:"col"},"金額小計"),t("th",{scope:"col"},"取消")])],-1)),et={scope:"row"},at=["src"],ot={style:{width:"150px"}},lt={class:"input-group input-group-sm"},ct={class:"input-group mb-3"},it=["onBlur","onUpdate:modelValue"],nt={class:"input-group-text",id:"basic-addon2"},rt=["onClick"],dt={class:"row"},mt={class:"row"},ht=o(()=>t("label",{for:"staticTotal",class:"col-12 col-md-4 col-lg-3 col-form-label"},"訂單金額小計：",-1)),bt={class:"col-12 col-md-8 col-lg-9"},ut={class:"mb-3"},pt=["value"],_t={class:"row"},ft=o(()=>t("label",{for:"code",class:"col-12 col-md-4 col-lg-3 col-form-label"},"使用優惠碼：",-1)),vt={class:"col-12 col-sm-6 col-md-3 col-lg-4 mb-3"},yt=o(()=>t("div",{class:"col-12 col-sm-6 col-md-5 col-lg-5 mb-3"},[t("button",{type:"submit",class:"btn btn-primary"}," 套用優惠碼 ")],-1)),gt={class:"row"},wt=o(()=>t("label",{for:"staticTotal",class:"col-12 col-md-4 col-lg-3 col-form-label"},"您的優惠折扣：",-1)),xt={class:"col-12 col-md-8 col-lg-9"},Ct={class:"mb-3"},Tt=["value"],$t={class:"row"},kt=o(()=>t("label",{for:"staticTotal",class:"col-12 col-md-4 col-lg-3 col-form-label"},"折扣後訂單總金額：",-1)),St={class:"col-12 col-md-8 col-lg-9"},qt={class:"mb-3"},Nt=["value"],Ft={class:"text-end"},Pt={class:"tab-pane fade",id:"profile-tab-pane",role:"tabpanel","aria-labelledby":"profile-tab",tabindex:"0"},It=o(()=>t("div",{class:"my-3"},[t("h5",null,"填寫收件資訊")],-1)),Et={class:"row"},Vt={class:"col-12 justify-content-center"},Bt={class:"mb-3"},jt=o(()=>t("label",{for:"name",class:"form-label"},"收件人姓名",-1)),Mt={class:"mb-3"},Ut=o(()=>t("label",{for:"mobilePhone",class:"form-label"},"收件人手機號碼",-1)),Dt={class:"mb-3"},zt=o(()=>t("label",{for:"email",class:"form-label"},"Email",-1)),At={class:"mb-3"},Lt=o(()=>t("label",{for:"address",class:"form-label"},"收件人地址",-1)),Gt={class:"mb-3"},Ht=o(()=>t("label",{for:"message",class:"form-label"},"留言",-1)),Jt=o(()=>t("div",{class:"text-end"},[t("button",{type:"submit",class:"btn btn-primary"}," 送出訂單 ")],-1)),Kt={class:"tab-pane fade",id:"pay-tab-pane",role:"tabpanel","aria-labelledby":"pay-tab",tabindex:"0"},Ot=o(()=>t("div",{class:"my-3"},[t("h5",null,"填寫信用卡資訊")],-1)),Qt={class:"row"},Rt={class:"col-12 justify-content-center"},Wt={class:"mb-3"},Xt=o(()=>t("label",{for:"creditCard",class:"form-label"},"信用卡號",-1)),Yt=o(()=>t("div",{class:"row"},[t("div",{class:"col-md-12"},[t("label",{for:"firstName",class:"form-label"},"持卡人姓名")])],-1)),Zt={class:"row"},ts={class:"mb-3 col-md-6"},ss={class:"mb-3 col-md-6"},es=o(()=>t("div",{class:"row"},[t("div",{class:"col-md-12"},[t("label",{for:"month",class:"form-label"},"有效期限")])],-1)),as={class:"row"},os={class:"mb-3 col-md-6"},ls={class:"mb-3 col-md-6"},cs={class:"mb-3"},is=o(()=>t("label",{for:"security",class:"form-label"},"安全碼",-1)),ns=o(()=>t("div",{class:"text-end"},[t("button",{type:"submit",class:"btn btn-primary"}," 付款 ")],-1)),rs=o(()=>t("div",{class:"tab-pane fade",id:"success-tab-pane",role:"tabpanel","aria-labelledby":"success-tab",tabindex:"0"},[t("div",{class:"my-3"},[t("h5",null,"完成訂購")]),t("div",null,"交易已完成，您可於三至五分鐘後至電子信箱收取訂單資訊郵件。"),t("div",null,"謝謝您的購買與支持，小幫手正快馬加鞭包裝與出貨中。"),t("div",null,"關於訂單若有任何需求，請洽0800-000-000，將由專人為您服務。")],-1));function ds(s,l,p,w,d,r){const C=u("CNavbar"),c=u("v-field"),_=u("v-form"),i=u("error-message"),T=u("CFooter");return v(),y(x,null,[a(C),t("div",M,[t("div",U,[t("div",D,[t("ul",z,[t("li",A,[t("button",L,"確認訂單",512)]),t("li",G,[t("button",H,"收件資訊",512)]),t("li",J,[t("button",K,"付款資訊",512)]),t("li",O,[t("button",Q,"完成訂購",512)])]),t("div",R,[t("div",W,[X,t("div",Y,[t("div",Z,[t("table",tt,[st,t("tbody",null,[(v(!0),y(x,null,F(d.carts,(e,$)=>(v(),y("tr",{key:e.id},[t("th",et,h($+1),1),t("td",null,[t("img",{src:e.product.imageUrl,style:{"object-fit":"cover",height:"150px","max-width":"150px"},alt:"",srcset:""},null,8,at)]),t("td",null,h(e.product.title),1),t("td",null,h(e.product.origin_price),1),t("td",null,h(e.product.price),1),t("td",ot,[t("div",lt,[t("div",ct,[P(t("input",{min:"1",type:"number",class:"form-control",onBlur:f=>r.updateCart(e.id,e.product.id,e.qty),"onUpdate:modelValue":f=>e.qty=f},null,40,it),[[I,e.qty]]),t("span",nt,h(e.product.unit),1)])])]),t("td",null,h(e.total)+" 元",1),t("td",null,[t("button",{type:"button",class:"btn btn-danger",onClick:f=>r.deleteCart(e.id,e.product.id)},"刪除",8,rt)])]))),128))])])])]),t("div",dt,[a(_,{onSubmit:r.handleCouponSubmit,ref:"couponForm",class:"col"},{default:g(()=>[t("div",mt,[ht,t("div",bt,[t("div",ut,[t("input",{type:"text",readonly:"",class:"form-control-plaintext",id:"staticTotal",value:`${d.total} 元`},null,8,pt)])])]),t("div",_t,[ft,t("div",vt,[a(c,{id:"code",name:"code",type:"text",class:"form-control",placeholder:"請輸入優惠碼"})]),yt]),t("div",gt,[wt,t("div",xt,[t("div",Ct,[t("input",{type:"text",readonly:"",class:"form-control-plaintext",id:"staticTotal",value:d.final_total!==d.total?`${parseInt(100*d.final_total/d.total,10)} ％`:"無"},null,8,Tt)])])]),t("div",$t,[kt,t("div",St,[t("div",qt,[t("input",{type:"text",readonly:"",class:"form-control-plaintext",id:"staticTotal",value:`${d.final_total} 元`},null,8,Nt)])])]),t("div",Ft,[t("button",{type:"button",class:"btn btn-primary",onClick:l[0]||(l[0]=(...e)=>r.handleConfirmSubmit&&r.handleConfirmSubmit(...e))},"下一步")])]),_:1},8,["onSubmit"])])]),t("div",Pt,[It,t("div",Et,[t("div",Vt,[a(_,{onSubmit:r.handleProfileSubmit,ref:"profileForm",class:"col"},{default:g(({errors:e})=>[t("div",Bt,[jt,a(c,{id:"name",name:"name",type:"text",class:n(["form-control",{"is-invalid":e.name}]),placeholder:"請輸入姓名",rules:"required"},null,8,["class"]),a(i,{name:"name",class:"invalid-feedback"})]),t("div",Mt,[Ut,a(c,{id:"mobilePhone",name:"mobilePhone",type:"text",class:n(["form-control",{"is-invalid":e.mobilePhone}]),placeholder:"請輸入手機號碼",rules:r.checkMobilePhone},null,8,["class","rules"]),a(i,{name:"mobilePhone",class:"invalid-feedback"})]),t("div",Dt,[zt,a(c,{id:"email",name:"email",type:"email",class:n(["form-control",{"is-invalid":e.email}]),placeholder:"請輸入 Email",rules:"email|required"},null,8,["class"]),a(i,{name:"email",class:"invalid-feedback"})]),t("div",At,[Lt,a(c,{id:"address",name:"address",type:"text",class:n(["form-control",{"is-invalid":e.address}]),placeholder:"請輸入地址",rules:"required"},null,8,["class"]),a(i,{name:"address",class:"invalid-feedback"})]),t("div",Gt,[Ht,a(c,{id:"message",name:"message",class:"form-control",cols:"30",rows:"10",rules:"required",as:"textarea"})]),Jt]),_:1},8,["onSubmit"])])])]),t("div",Kt,[Ot,t("div",Qt,[t("div",Rt,[a(_,{onSubmit:r.handlePaySubmit,ref:"payForm",class:"col"},{default:g(({errors:e})=>[t("div",Wt,[Xt,a(c,{id:"creditCard",name:"creditCard",type:"text",class:n(["form-control",{"is-invalid":e.creditCard}]),placeholder:"請輸入信用卡號",rules:{required:!0,regex:/^\d{4}-\d{4}-\d{4}-\d{4}$/}},null,8,["class"]),a(i,{name:"creditCard",class:"invalid-feedback"})]),Yt,t("div",Zt,[t("div",ts,[a(c,{id:"firstName",name:"firstName",type:"text",class:n(["form-control",{"is-invalid":e.firstName}]),placeholder:"請輸入姓氏",rules:"required"},null,8,["class"]),a(i,{name:"firstName",class:"invalid-feedback"})]),t("div",ss,[a(c,{id:"lastName",name:"lastName",type:"text",class:n(["form-control",{"is-invalid":e.lastName}]),placeholder:"請輸入名字",rules:"required"},null,8,["class"]),a(i,{name:"lastName",class:"invalid-feedback"})])]),es,t("div",as,[t("div",os,[a(c,{id:"month",name:"month",type:"text",class:n(["form-control",{"is-invalid":e.month}]),placeholder:"請輸入月份",rules:"required"},null,8,["class"]),a(i,{name:"month",class:"invalid-feedback"})]),t("div",ls,[a(c,{id:"year",name:"year",type:"text",class:n(["form-control",{"is-invalid":e.year}]),placeholder:"請輸入年份",rules:"required"},null,8,["class"]),a(i,{name:"year",class:"invalid-feedback"})])]),t("div",cs,[is,a(c,{id:"security",name:"security",type:"text",class:n(["form-control",{"is-invalid":e.security}]),placeholder:"請輸入安全碼",rules:"required"},null,8,["class"]),a(i,{name:"security",class:"invalid-feedback"})]),ns]),_:1},8,["onSubmit"])])])]),rs])])])]),a(T)],64)}const ps=q(j,[["render",ds],["__scopeId","data-v-eaa421dd"]]);export{ps as default};
