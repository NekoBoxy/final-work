import{a as b}from"./axios-bff3f665.js";import{h as O}from"./moment-fbc5633a.js";import{C as x}from"./CPagination-20dbdc5d.js";import{_ as f,M as v,o as a,a as n,b as e,i as w,t as o,F as h,f as g,m as $,r as p,e as m,u as L}from"./index-da3366f3.js";const M={props:{order:Object,on_finish:Function},data(){return{}},methods:{show(){this.modal.show()},hide(){this.modal.hide()},async handleRemove(){try{await b({method:"delete",url:`https://vue3-course-api.hexschool.io/v2/api/catboxy/admin/order/${this.order.id}`}).catch(t=>{throw t.response.data.message}),this.modal.hide(),this.$emit("on_finish")}catch(t){alert(t)}}},async mounted(){this.modal=new v(this.$refs.modal)}},D={ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},P={class:"modal-dialog"},Y={class:"modal-content border-0"},A=e("div",{class:"modal-header bg-danger text-white"},[e("h5",{id:"delProductModalLabel",class:"modal-title"},[e("span",null,"刪除訂單")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),S={class:"modal-body"},F={class:"text-danger"},V={class:"modal-footer"},j=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function B(t,l,_,y,s,d){return a(),n("div",D,[e("div",P,[e("div",Y,[A,e("div",S,[w(" 是否刪除 "),e("strong",F,o(_.order.id),1),w(" 訂單(刪除後將無法恢復)。 ")]),e("div",V,[j,e("button",{type:"button",class:"btn btn-danger",onClick:l[0]||(l[0]=(...r)=>d.handleRemove&&d.handleRemove(...r))}," 確認刪除 ")])])])],512)}const N=f(M,[["render",B]]),R={props:{order:{type:Object,default(){return{products:{},user:{}}}},on_update:Function},data(){return{modal:null,newOrder:{products:{},user:{}}}},watch:{order(t){this.newOrder={...t}}},methods:{handlePaidChange(t){this.newOrder.is_paid=t.target.checked},handleSubmit(){this.$emit("on_update",this.newOrder),this.modal.hide()},show(){this.modal.show()},hide(){this.modal.hide()},getDate(t){return O(t*1e3).format("YYYY/MM/DD")}},async mounted(){this.modal=new v(this.$refs.modal)}},q={class:"modal fade",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},E={class:"modal-dialog modal-xl",role:"document"},T={class:"modal-content border-0"},z=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),G={class:"modal-body",style:{"text-align":"left"}},H={class:"row"},I={class:"col-sm-4"},J=e("h4",null,"用戶資料",-1),K={class:"table"},Q=e("th",{scope:"row"},"姓名",-1),U=e("th",{scope:"row"},"信箱",-1),W=e("th",{scope:"row"},"電話",-1),X=e("th",{scope:"row"},"地址",-1),Z={class:"col-sm-8"},ee=e("h4",null,"訂單細節",-1),te={class:"table"},se=e("th",{scope:"row"},"訂單編號",-1),oe=e("th",{scope:"row"},"下單時間",-1),de=e("th",{scope:"row"},"付款時間",-1),ae={key:0},ne={key:1},le=e("th",{scope:"row"},"付款狀態",-1),re={key:0},ie={key:1},ce=e("th",{scope:"row"},"總金額",-1),he=e("h4",null,"選購商品",-1),_e={class:"table"},ue={scope:"row"},pe={class:"d-flex justify-content-end"},me={class:"form-check"},be=["checked"],ge={class:"form-check-label",for:"is_paid"},fe={key:0},ye={key:1},we={class:"modal-footer"},Oe=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ve(t,l,_,y,s,d){return a(),n("div",q,[e("div",E,[e("div",T,[z,e("div",G,[e("div",H,[e("div",I,[J,e("table",K,[e("tbody",null,[e("tr",null,[Q,e("td",null,o(s.newOrder.user.name),1)]),e("tr",null,[U,e("td",null,o(s.newOrder.user.email),1)]),e("tr",null,[W,e("td",null,o(s.newOrder.user.tel),1)]),e("tr",null,[X,e("td",null,o(s.newOrder.user.address),1)])])])]),e("div",Z,[ee,e("table",te,[e("tbody",null,[e("tr",null,[se,e("td",null,o(s.newOrder.id),1)]),e("tr",null,[oe,e("td",null,o(d.getDate(s.newOrder.create_at)),1)]),e("tr",null,[de,e("td",null,[s.newOrder.is_paid&&s.newOrder.paid_date?(a(),n("span",ae,o(d.getDate(s.newOrder.paid_date)),1)):(a(),n("span",ne,"無紀錄"))])]),e("tr",null,[le,e("td",null,[s.newOrder.is_paid?(a(),n("span",re,"已付款")):(a(),n("span",ie,"未付款"))])]),e("tr",null,[ce,e("td",null,o(s.newOrder.total),1)])])]),he,e("table",_e,[e("tbody",null,[(a(!0),n(h,null,g(s.newOrder.products,(r,u)=>(a(),n("tr",{key:u},[e("th",ue,o(r.product.title),1),e("td",null,o(r.qty)+" "+o(r.product.unit),1),e("td",null,o(r.total),1)]))),128))])]),e("div",pe,[e("div",me,[e("input",{class:"form-check-input",type:"checkbox",value:"",id:"is_paid",onChange:l[0]||(l[0]=(...r)=>d.handlePaidChange&&d.handlePaidChange(...r)),checked:s.newOrder.is_paid},null,40,be),e("label",ge,[s.newOrder.is_paid?(a(),n("span",fe,"已付款")):(a(),n("span",ye,"未付款"))])])])])])]),e("div",we,[Oe,e("button",{type:"button",class:"btn btn-primary",onClick:l[1]||(l[1]=(...r)=>d.handleSubmit&&d.handleSubmit(...r))}," 修改付款狀態 ")])])])],512)}const ke=f(R,[["render",ve]]),Ce={data(){return{orders:[],order:{},pagination:{total_pages:"",current_page:1,has_pre:!1,has_next:!1,category:""}}},components:{CPagination:x,CModalOrderList:ke,CModalOrderDelete:N},methods:{...$(L,["setLoader"]),showOrder(t){this.order=t,this.$refs.CModalOrderList.show()},deleteOrder(t){this.order=t,this.$refs.CModalOrderDelete.show()},async handlePaidChange(t){this.setLoader(!0),t.is_paid=!t.is_paid,await this.updateOrder(t),this.setLoader(!1)},async updateOrder(t){try{this.setLoader(!0),this.order=t,await b({method:"put",url:`https://vue3-course-api.hexschool.io/v2/api/catboxy/admin/order/${this.order.id}`,data:{data:this.order}}),await this.getAllOrders(),this.setLoader(!1)}catch(l){alert(l.response.data.message)}},async getAllOrders(t){try{this.setLoader(!0);const l=await b({method:"get",url:"https://vue3-course-api.hexschool.io/v2/api/catboxy/admin/orders",params:{page:t||this.pagination.current_page}});this.orders=l.data.orders,this.pagination=l.data.pagination,this.setLoader(!1)}catch(l){alert(l.response.data.message)}},getDate(t){return O.unix(t).format("YYYY/MM/DD")}},async mounted(){this.setLoader(!0),await this.getAllOrders(),this.setLoader(!1)}},xe={class:"container"},$e={class:"row"},Le={class:"col-12"},Me={class:"table align-middle"},De=e("thead",null,[e("tr",null,[e("th",null,"購買時間"),e("th",null,"信箱"),e("th",null,"購買項目"),e("th",null,"應付金額"),e("th",null,"是否付款"),e("th",null,"編輯")])],-1),Pe={class:"form-check form-switch"},Ye=["onChange","checked"],Ae={class:"form-check-label",for:"is_paid"},Se={key:0},Fe={key:1},Ve={class:"btn-group btn-group-sm"},je=["onClick"],Be=["onClick"],Ne={class:"row"},Re={class:"col-12"};function qe(t,l,_,y,s,d){const r=p("CModalOrderList"),u=p("CModalOrderDelete"),k=p("CPagination");return a(),n(h,null,[m(r,{order:s.order,onOn_update:d.updateOrder,ref:"CModalOrderList"},null,8,["order","onOn_update"]),m(u,{order:s.order,onOn_finish:d.getAllOrders,ref:"CModalOrderDelete"},null,8,["order","onOn_finish"]),e("div",xe,[e("div",$e,[e("div",Le,[e("table",Me,[De,e("tbody",null,[(a(!0),n(h,null,g(s.orders,i=>(a(),n("tr",{key:i.id},[e("td",null,o(d.getDate(i.create_at)),1),e("td",null,o(i.user.email),1),e("td",null,[(a(!0),n(h,null,g(i.products,(c,C)=>(a(),n("div",{key:C},o(c.product.title)+" 數量： "+o(c.qty)+" "+o(c.product.unit),1))),128))]),e("td",null,o(i.total),1),e("td",null,[e("div",Pe,[e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"is_paid",onChange:c=>d.handlePaidChange(i),checked:i.is_paid},null,40,Ye),e("label",Ae,[i.is_paid?(a(),n("span",Se,"已付款")):(a(),n("span",Fe,"未付款"))])])]),e("td",null,[e("div",Ve,[e("button",{type:"button",class:"btn btn-outline-primary",onClick:c=>d.showOrder(i)}," 檢視 ",8,je),e("button",{type:"button",class:"btn btn-outline-danger",onClick:c=>d.deleteOrder(i)}," 刪除 ",8,Be)])])]))),128))])])])]),e("div",Ne,[e("div",Re,[m(k,{total_pages:s.pagination.total_pages,onOn_page:d.getAllOrders},null,8,["total_pages","onOn_page"])])])])],64)}const He=f(Ce,[["render",qe]]);export{He as default};
