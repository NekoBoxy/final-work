import{a as b}from"./axios-bff3f665.js";import{h as m}from"./moment-fbc5633a.js";import{C as M}from"./CPagination-1e6bd0d8.js";import{_ as f,M as v,o as d,a as i,b as t,l as u,s as r,y as k,i as g,t as p,m as D,r as h,e as _,F as y,f as L,u as O}from"./index-a5e9ff6a.js";const S={props:{status:String,coupon:{type:Object,default(){return{}}},on_finish:Function},data(){return{newCoupon:{},modal:null}},watch:{coupon(e){this.newCoupon={...e,due_date:m.unix(e.due_date).format("YYYY-MM-DD")}}},methods:{show(){this.modal.show()},hide(){this.modal.hide()},async handleSubmit(){this.newCoupon.due_date=m(this.newCoupon.due_date).unix();try{let e="",o="";this.status==="new"?(e="post",o="https://vue3-course-api.hexschool.io/v2/api/catboxy/admin/coupon"):(e="put",o=`https://vue3-course-api.hexschool.io/v2/api/catboxy/admin/coupon/${this.newCoupon.id}`),await b({method:e,url:o,data:{data:this.newCoupon}}).catch(c=>{throw c.response.data.message}),this.modal.hide(),this.$emit("on_finish")}catch(e){alert(e)}}},async mounted(){this.modal=new v(this.$refs.modal)}},V={ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},Y={class:"modal-dialog"},N={class:"modal-content border-0"},P={class:"modal-header bg-dark text-white"},U={id:"couponModalLabel",class:"modal-title"},E={key:0},F={key:1},B=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),R={class:"modal-body",style:{"text-align":"left"}},j={class:"row"},J={class:"col"},T={class:"mb-3"},A=t("label",{for:"title",class:"form-label"},"標題",-1),q={class:"mb-3"},z=t("label",{for:"code",class:"form-label"},"優惠碼",-1),G={class:"mb-3"},H=t("label",{for:"due_date",class:"form-label"},"到期日",-1),I={class:"mb-3"},K=t("label",{for:"percent",class:"form-label"},"折扣百分比",-1),Q={class:"mb-3"},W={class:"form-check"},X=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Z={class:"modal-footer"},tt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ot(e,o,c,C,s,a){return d(),i("div",V,[t("div",Y,[t("div",N,[t("div",P,[t("h5",U,[c.status==="new"?(d(),i("span",E,"新增產品")):(d(),i("span",F,"編輯產品"))]),B]),t("div",R,[t("div",j,[t("div",J,[t("div",T,[A,u(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":o[0]||(o[0]=n=>s.newCoupon.title=n)},null,512),[[r,s.newCoupon.title]])]),t("div",q,[z,u(t("input",{id:"code",type:"text",class:"form-control",placeholder:"請輸入優惠碼","onUpdate:modelValue":o[1]||(o[1]=n=>s.newCoupon.code=n)},null,512),[[r,s.newCoupon.code]])]),t("div",G,[H,u(t("input",{id:"due_date",type:"date",class:"form-control",placeholder:"請輸入到期日","onUpdate:modelValue":o[2]||(o[2]=n=>s.newCoupon.due_date=n)},null,512),[[r,s.newCoupon.due_date]])]),t("div",I,[K,u(t("input",{id:"percent",type:"number",class:"form-control",min:"0",max:"100",placeholder:"請輸入折扣百分比","onUpdate:modelValue":o[3]||(o[3]=n=>s.newCoupon.percent=n)},null,512),[[r,s.newCoupon.percent]])]),t("div",Q,[t("div",W,[u(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":o[4]||(o[4]=n=>s.newCoupon.is_enabled=n)},null,512),[[k,s.newCoupon.is_enabled]]),X])])])])]),t("div",Z,[tt,t("button",{type:"button",class:"btn btn-primary",onClick:o[5]||(o[5]=(...n)=>a.handleSubmit&&a.handleSubmit(...n))}," 確認 ")])])])],512)}const et=f(S,[["render",ot]]),st={props:{coupon:Object,on_finish:Function},data(){return{}},methods:{show(){this.modal.show()},hide(){this.modal.hide()},async handleRemove(){try{await b({method:"delete",url:`https://vue3-course-api.hexschool.io/v2/api/catboxy/admin/coupon/${this.coupon.id}`}).catch(e=>{throw e.response.data.message}),this.modal.hide(),this.$emit("on_finish")}catch(e){alert(e)}}},async mounted(){this.modal=new v(this.$refs.modal)}},nt={ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},at={class:"modal-dialog"},lt={class:"modal-content bcoupon-0"},dt=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"刪除優惠券")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),it={class:"modal-body"},ct={class:"text-danger"},ut={class:"modal-footer"},rt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function pt(e,o,c,C,s,a){return d(),i("div",nt,[t("div",at,[t("div",lt,[dt,t("div",it,[g(" 是否刪除 "),t("strong",ct,p(c.coupon.title),1),g(" 優惠券(刪除後將無法恢復)。 ")]),t("div",ut,[rt,t("button",{type:"button",class:"btn btn-danger",onClick:o[0]||(o[0]=(...n)=>a.handleRemove&&a.handleRemove(...n))}," 確認刪除 ")])])])],512)}const ht=f(st,[["render",pt]]),_t={data(){return{status:"",coupons:[],pagination:{total_pages:1,current_page:1,has_pre:!1,has_next:!1,category:""},coupon:{}}},components:{CPagination:M,CModalCouponsDelete:ht,CModalCouponsEdit:et},methods:{...D(O,["setLoader"]),addCoupon(){this.status="new",this.coupon={},this.$refs.adminCouponModal.show()},editCoupon(e){this.status="edit",this.coupon=JSON.parse(JSON.stringify(e)),this.$refs.adminCouponModal.show()},deleteCoupon(e){this.coupon=e,this.$refs.adminDeleteCouponModal.show()},async getCoupons(e){try{this.setLoader(!0);const o=await b({method:"get",url:"https://vue3-course-api.hexschool.io/v2/api/catboxy/admin/coupons",params:{page:e||this.pagination.current_page}});this.coupons=o.data.coupons,this.pagination=o.data.pagination,this.setLoader(!1)}catch(o){alert(o.response.data.message)}},getDate(e){return m.unix(e).format("YYYY/MM/DD")}},async mounted(){this.setLoader(!0),await this.getCoupons(),this.setLoader(!1)}},mt={class:"container"},bt={class:"text-end mt-4"},ft={class:"text-center"},Ct={class:"row"},gt={class:"col-12"},yt={class:"table align-middle"},vt=t("thead",null,[t("tr",null,[t("th",null,"名稱"),t("th",null,"折扣百分比"),t("th",null,"到期日"),t("th",null,"是否啟用"),t("th",null,"編輯")])],-1),wt={key:0},xt={key:1},$t={class:"btn-group btn-group-sm"},Mt=["onClick"],kt=["onClick"],Dt={class:"row"},Lt={class:"col-12"};function Ot(e,o,c,C,s,a){const n=h("CModalCouponsEdit"),w=h("CModalCouponsDelete"),x=h("CPagination");return d(),i(y,null,[_(n,{coupon:s.coupon,onOn_finish:a.getCoupons,status:s.status,ref:"adminCouponModal"},null,8,["coupon","onOn_finish","status"]),_(w,{coupon:s.coupon,onOn_finish:a.getCoupons,ref:"adminDeleteCouponModal"},null,8,["coupon","onOn_finish"]),t("div",mt,[t("div",bt,[t("button",{type:"button",class:"btn btn-outline-primary",onClick:o[0]||(o[0]=(...l)=>a.addCoupon&&a.addCoupon(...l))}," 建立新的優惠券 ")]),t("div",ft,[t("div",Ct,[t("div",gt,[t("table",yt,[vt,t("tbody",null,[(d(!0),i(y,null,L(s.coupons,l=>(d(),i("tr",{key:l.id},[t("td",null,p(l.title),1),t("td",null,p(l.percent)+"%",1),t("td",null,p(a.getDate(l.due_date)),1),t("td",null,[l.is_enabled?(d(),i("span",wt,"啟用")):(d(),i("span",xt,"未啟用"))]),t("td",null,[t("div",$t,[t("button",{type:"button",class:"btn btn-outline-primary",onClick:$=>a.editCoupon(l)}," 編輯 ",8,Mt),t("button",{type:"button",class:"btn btn-outline-danger",onClick:$=>a.deleteCoupon(l)}," 刪除 ",8,kt)])])]))),128))])])])]),t("div",Dt,[t("div",Lt,[_(x,{total_pages:s.pagination.total_pages,onOn_page:a.getCoupons},null,8,["total_pages","onOn_page"])])])])])],64)}const Pt=f(_t,[["render",Ot]]);export{Pt as default};
